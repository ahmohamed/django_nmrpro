!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.specdraw=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a){function b(a){var b=d3.select(a).style("position");return"absolute"===b||"static"===b?{x:a.offsetLeft,y:a.offsetTop,w:a.offsetWidth,h:a.offsetHeight}:{x:0,y:0,w:a.offsetWidth,h:a.offsetHeight}}var c="object"==typeof a.bootstrap?a.bootstrap:a.bootstrap={};c.tooltip=function(){function a(){var a=d3.select(this),b=g.apply(this,arguments),e=a.append("div").attr("class","tooltip");b&&e.classed("fade",!0),e.append("div").attr("class","tooltip-arrow"),e.append("div").attr("class","tooltip-inner");var f=l.apply(this,arguments);e.classed(f,!0),a.on(j,c),a.on(k,d)}function c(){var a,c=d3.select(this),d=i.apply(this,arguments),e=c.select(".tooltip").classed("in",!0),f=h.apply(this,arguments),g=(e.select(".tooltip-inner")[f?"html":"text"](d),l.apply(this,arguments)),j=c.style("position"),k=b(c.node()),m=b(e.node());("absolute"===j||"relative"===j)&&(k.x=k.y=0);var a;switch(g){case"top":a={x:k.x+(k.w-m.w)/2,y:k.y-m.h};break;case"right":a={x:k.x+k.w,y:k.y+(k.h-m.h)/2};break;case"left":a={x:k.x-m.w,y:k.y+(k.h-m.h)/2};break;case"bottom":a={x:Math.max(0,k.x+(k.w-m.w)/2),y:k.y+k.h}}e.style(a?{left:~~a.x+"px",top:~~a.y+"px"}:{left:null,top:null}),this.tooltipVisible=!0}function d(){d3.select(this).select(".tooltip").classed("in",!1),this.tooltipVisible=!1}function e(){this.tooltipVisible?d.apply(this,arguments):c.apply(this,arguments)}var f=function(b){b.each(a)},g=d3.functor(!1),h=d3.functor(!1),i=function(){var a=this.getAttribute("data-original-title");return a?a:(a=this.getAttribute("title"),this.removeAttribute("title"),this.setAttribute("data-original-title",a),a)},j="mouseenter.tooltip",k="mouseleave.tooltip",l=("top left bottom right".split(" "),d3.functor("top"));return f.title=function(a){return arguments.length?(i=d3.functor(a),f):i},f.html=function(a){return arguments.length?(h=d3.functor(a),f):h},f.placement=function(a){return arguments.length?(l=d3.functor(a),f):l},f.show=function(a){a.each(c)},f.hide=function(a){a.each(d)},f.toggle=function(a){a.each(e)},f.destroy=function(a){a.on(j,null).on(k,null).attr("title",function(){return this.getAttribute("data-original-title")||this.getAttribute("title")}).attr("data-original-title",null).select(".tooltip").remove()},f}}(this)},{}],2:[function(b,c,d){!function(b,d){"function"==typeof a&&a.amd?a(["d3"],d):"object"==typeof c&&c.exports?c.exports=function(a){return a.tip=d(a),a.tip}:b.d3.tip=d(b.d3)}(this,function(a){return function(){function b(a){y=o(a),z=y.createSVGPoint(),document.body.appendChild(x)}function c(){return"n"}function d(){return[0,0]}function e(){return" "}function f(){var a=q();return{top:a.n.y-x.offsetHeight,left:a.n.x-x.offsetWidth/2}}function g(){var a=q();return{top:a.s.y,left:a.s.x-x.offsetWidth/2}}function h(){var a=q();return{top:a.e.y-x.offsetHeight/2,left:a.e.x}}function i(){var a=q();return{top:a.w.y-x.offsetHeight/2,left:a.w.x-x.offsetWidth}}function j(){var a=q();return{top:a.nw.y-x.offsetHeight,left:a.nw.x-x.offsetWidth}}function k(){var a=q();return{top:a.ne.y-x.offsetHeight,left:a.ne.x}}function l(){var a=q();return{top:a.sw.y,left:a.sw.x-x.offsetWidth}}function m(){var a=q();return{top:a.se.y,left:a.e.x}}function n(){var b=a.select(document.createElement("div"));return b.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),b.node()}function o(a){return a=a.node(),"svg"===a.tagName.toLowerCase()?a:a.ownerSVGElement}function p(){return null===x&&(x=n(),document.body.appendChild(x)),a.select(x)}function q(){for(var b=A||a.event.target;"undefined"==typeof b.getScreenCTM&&"undefined"===b.parentNode;)b=b.parentNode;var c={},d=b.getScreenCTM(),e=b.getBBox(),f=e.width,g=e.height,h=e.x,i=e.y;return z.x=h,z.y=i,c.nw=z.matrixTransform(d),z.x+=f,c.ne=z.matrixTransform(d),z.y+=g,c.se=z.matrixTransform(d),z.x-=f,c.sw=z.matrixTransform(d),z.y-=g/2,c.w=z.matrixTransform(d),z.x+=f,c.e=z.matrixTransform(d),z.x-=f/2,z.y-=g/2,c.n=z.matrixTransform(d),z.y+=g,c.s=z.matrixTransform(d),c}var r=c,s=d,t=e,u=" ",v=null,w=!1,x=n(),y=null,z=null,A=null;b.show=function(){var a=Array.prototype.slice.call(arguments);a[a.length-1]instanceof SVGElement&&(A=a.pop());var c,d=t.apply(this,a),e=s.apply(this,a),f=r.apply(this,a),g=p(),h=C.length,i=document.documentElement.scrollTop||document.body.scrollTop,j=document.documentElement.scrollLeft||document.body.scrollLeft;for(w?(v.text(u),g.style({opacity:1,"pointer-events":"none"})):g.html(d).style({opacity:1,"pointer-events":"all"});h--;)g.classed(C[h],!1);return c=B.get(f).apply(this),g.classed(f,!0).style({top:c.top+e[0]+i+"px",left:c.left+e[1]+j+"px"}),b},b.hide=function(){var a=p();return a.style({opacity:0,"pointer-events":"none"}),b},b.attr=function(c,d){if(arguments.length<2&&"string"==typeof c)return p().attr(c);var e=Array.prototype.slice.call(arguments);return a.selection.prototype.attr.apply(p(),e),b},b.style=function(c,d){if(arguments.length<2&&"string"==typeof c)return p().style(c);var e=Array.prototype.slice.call(arguments);return a.selection.prototype.style.apply(p(),e),b},b.direction=function(c){return arguments.length?(r=null==c?c:a.functor(c),b):r},b.offset=function(c){return arguments.length?(s=null==c?c:a.functor(c),b):s},b.html=function(c){return arguments.length?(t=null==c?c:a.functor(c),b):t},b.text=function(a){return arguments.length?(u=null==a?" ":a,b):u},b.bootstrap=function(a){if(!arguments.length)return w;if(w=a,1==a){var c=p();c.html('<div class="tooltip-arrow"></div><div class="tooltip-inner">'+u+"</div>"),v=c.select(".tooltip-inner")}return b},b.destroy=function(){return x&&(p().remove(),x=null),b};var B=a.map({n:f,s:g,e:h,w:i,nw:j,ne:k,sw:l,se:m}),C=B.keys();return b}})},{}],3:[function(b,c,d){!function(b,d){"undefined"!=typeof c&&c.exports?c.exports=d():"function"==typeof a&&a.amd?a(d):this[b]=d()}("bowser",function(){function a(a){function c(b){var c=a.match(b);return c&&c.length>1&&c[1]||""}function d(b){var c=a.match(b);return c&&c.length>1&&c[2]||""}var e,f=c(/(ipod|iphone|ipad)/i).toLowerCase(),g=/like android/i.test(a),h=!g&&/android/i.test(a),i=/CrOS/.test(a),j=c(/edge\/(\d+(\.\d+)?)/i),k=c(/version\/(\d+(\.\d+)?)/i),l=/tablet/i.test(a),m=!l&&/[^-]mobi/i.test(a);/opera|opr/i.test(a)?e={name:"Opera",opera:b,version:k||c(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(a)?e={name:"Yandex Browser",yandexbrowser:b,version:k||c(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(a)?(e={name:"Windows Phone",windowsphone:b},j?(e.msedge=b,e.version=j):(e.msie=b,e.version=c(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(a)?e={name:"Internet Explorer",msie:b,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:i?e={name:"Chrome",chromeBook:b,chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(a)?e={name:"Microsoft Edge",msedge:b,version:j}:/chrome|crios|crmo/i.test(a)?e={name:"Chrome",chrome:b,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:f?(e={name:"iphone"==f?"iPhone":"ipad"==f?"iPad":"iPod"},k&&(e.version=k)):/sailfish/i.test(a)?e={name:"Sailfish",sailfish:b,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(a)?e={name:"SeaMonkey",seamonkey:b,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(a)?(e={name:"Firefox",firefox:b,version:c(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(a)&&(e.firefoxos=b)):/silk/i.test(a)?e={name:"Amazon Silk",silk:b,version:c(/silk\/(\d+(\.\d+)?)/i)}:h?e={name:"Android",version:k}:/phantom/i.test(a)?e={name:"PhantomJS",phantom:b,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(a)||/rim\stablet/i.test(a)?e={name:"BlackBerry",blackberry:b,version:k||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(a)?(e={name:"WebOS",webos:b,version:k||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(a)&&(e.touchpad=b)):e=/bada/i.test(a)?{name:"Bada",bada:b,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(a)?{name:"Tizen",tizen:b,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||k}:/safari/i.test(a)?{name:"Safari",safari:b,version:k}:{name:c(/^(.*)\/(.*) /),version:d(/^(.*)\/(.*) /)},!e.msedge&&/(apple)?webkit/i.test(a)?(e.name=e.name||"Webkit",e.webkit=b,!e.version&&k&&(e.version=k)):!e.opera&&/gecko\//i.test(a)&&(e.name=e.name||"Gecko",e.gecko=b,e.version=e.version||c(/gecko\/(\d+(\.\d+)?)/i)),e.msedge||!h&&!e.silk?f&&(e[f]=b,e.ios=b):e.android=b;var n="";e.windowsphone?n=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):f?(n=c(/os (\d+([_\s]\d+)*) like mac os x/i),n=n.replace(/[_\s]/g,".")):h?n=c(/android[ \/-](\d+(\.\d+)*)/i):e.webos?n=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):e.blackberry?n=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):e.bada?n=c(/bada\/(\d+(\.\d+)*)/i):e.tizen&&(n=c(/tizen[\/\s](\d+(\.\d+)*)/i)),n&&(e.osversion=n);var o=n.split(".")[0];return l||"ipad"==f||h&&(3==o||4==o&&!m)||e.silk?e.tablet=b:(m||"iphone"==f||"ipod"==f||h||e.blackberry||e.webos||e.bada)&&(e.mobile=b),e.msedge||e.msie&&e.version>=10||e.yandexbrowser&&e.version>=15||e.chrome&&e.version>=20||e.firefox&&e.version>=20||e.safari&&e.version>=6||e.opera&&e.version>=10||e.ios&&e.osversion&&e.osversion.split(".")[0]>=6||e.blackberry&&e.version>=10.1?e.a=b:e.msie&&e.version<10||e.chrome&&e.version<20||e.firefox&&e.version<20||e.safari&&e.version<6||e.opera&&e.version<10||e.ios&&e.osversion&&e.osversion.split(".")[0]<6?e.c=b:e.x=b,e}var b=!0,c=a("undefined"!=typeof navigator?navigator.userAgent:"");return c.test=function(a){for(var b=0;b<a.length;++b){var d=a[b];if("string"==typeof d&&d in c)return!0}return!1},c._detect=a,c})},{}],4:[function(a,b,c){!function(a,c){"object"==typeof b&&b.exports?b.exports=function(a){return a.contextMenu=c(a),a.contextMenu}:a.d3.contextMenu=c(a.d3)}(this,function(a){return function(b,c){return a.selectAll(".d3-context-menu").data([1]).enter().append("div").attr("class","d3-context-menu"),a.select("body").on("click.d3-context-menu",function(){a.select(".d3-context-menu").style("display","none")}),function(d,e){var f=this;a.selectAll(".d3-context-menu").html("");var g=a.selectAll(".d3-context-menu").append("ul");g.selectAll("li").data(b).enter().append("li").html(function(a){return"string"==typeof a.title?a.title:a.title(d)}).on("click",function(b,c){b.action(f,d,e),a.select(".d3-context-menu").style("display","none")}),c&&c(d,e)===!1||(a.select(".d3-context-menu").style("left",a.event.pageX-2+"px").style("top",a.event.pageY-2+"px").style("display","block"),a.event.preventDefault(),a.event.stopPropagation())}}})},{}],5:[function(a,b,c){"use strict";function d(){function a(a){for(var b=a.length,c=new Array(b),d=0;b>d;d++)c[d]=parseFloat(a[d]);return c}function b(b,i){i=i||{};var k=/^[A-Z]+$/;i.keepRecordsRegExp&&(k=i.keepRecordsRegExp);var l,m,n,o,p,q,r,s,t,u=new Date,v={},w={};w.profiling=[],w.logs=[];var x=[];w.spectra=x,w.info={};var y={};if("string"!=typeof b)return w;for(w.profiling&&w.profiling.push({action:"Before split to LDRS",time:new Date-u}),o=b.split(/[\r\n]+##/),w.profiling&&w.profiling.push({action:"Split to LDRS",time:new Date-u}),o[0]&&(o[0]=o[0].replace(/^[\r\n ]*##/,"")),p=0,q=o.length;q>p;p++){if(l=o[p],r=l.indexOf("="),r>0?(m=l.substring(0,r),n=l.substring(r+1).trim()):(m=l,n=""),m=m.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===m&&(s=n.indexOf("\n"),-1===s&&(s=n.indexOf("\r")),s>0)){var z=-1,A=-1;if(t=n.substring(0,s).split(/[ ,;\t]+/),t[0].indexOf("++")>0){var B=t[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),C=t[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");z=v.symbol.indexOf(B),A=v.symbol.indexOf(C)}-1===z&&(z=0),-1===A&&(A=0),v.first&&(v.first.length>z&&(y.firstX=v.first[z]),v.first.length>A&&(y.firstY=v.first[A])),v.last&&(v.last.length>z&&(y.lastX=v.last[z]),v.last.length>A&&(y.lastY=v.last[A])),v.vardim&&v.vardim.length>z&&(y.nbPoints=v.vardim[z]),v.factor&&(v.factor.length>z&&(y.xFactor=v.factor[z]),v.factor.length>A&&(y.yFactor=v.factor[A])),v.units&&(v.units.length>z&&(y.xUnit=v.units[z]),v.units.length>A&&(y.yUnit=v.units[A])),y.datatable=t[0],t[1]&&t[1].indexOf("PEAKS")>-1?m="PEAKTABLE":t[1]&&(t[1].indexOf("XYDATA")||t[0].indexOf("++")>0)&&(m="XYDATA",y.deltaX=(y.lastX-y.firstX)/(y.nbPoints-1))}if("TITLE"===m)y.title=n;else if("DATATYPE"===m)y.dataType=n,n.indexOf("nD")>-1&&(w.twoD=!0);else if("XUNITS"===m)y.xUnit=n;else if("YUNITS"===m)y.yUnit=n;else if("FIRSTX"===m)y.firstX=parseFloat(n);else if("LASTX"===m)y.lastX=parseFloat(n);else if("FIRSTY"===m)y.firstY=parseFloat(n);else if("NPOINTS"===m)y.nbPoints=parseFloat(n);else if("XFACTOR"===m)y.xFactor=parseFloat(n);else if("YFACTOR"===m)y.yFactor=parseFloat(n);else if("DELTAX"===m)y.deltaX=parseFloat(n);else if(".OBSERVEFREQUENCY"===m||"$SFO1"===m)y.observeFrequency||(y.observeFrequency=parseFloat(n));else if(".OBSERVENUCLEUS"===m)y.xType||(w.xType=n.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===m)w.indirectFrequency||(w.indirectFrequency=parseFloat(n));else if("$OFFSET"===m)w.shiftOffsetNum=0,w.shiftOffsetVal||(w.shiftOffsetVal=parseFloat(n));else if("$REFERENCEPOINT"===m);else if("VARNAME"===m)v.varname=n.split(/[, \t]{2,}/);else if("SYMBOL"===m)v.symbol=n.split(/[, \t]{2,}/);else if("VARTYPE"===m)v.vartype=n.split(/[, \t]{2,}/);else if("VARFORM"===m)v.varform=n.split(/[, \t]{2,}/);else if("VARDIM"===m)v.vardim=a(n.split(/[, \t]{2,}/));else if("UNITS"===m)v.units=n.split(/[, \t]{2,}/);else if("FACTOR"===m)v.factor=a(n.split(/[, \t]{2,}/));else if("FIRST"===m)v.first=a(n.split(/[, \t]{2,}/));else if("LAST"===m)v.last=a(n.split(/[, \t]{2,}/));else if("MIN"===m)v.min=a(n.split(/[, \t]{2,}/));else if("MAX"===m)v.max=a(n.split(/[, \t]{2,}/));else if(".NUCLEUS"===m)w.twoD&&(w.yType=n.split(/[, \t]{2,}/)[0]);else if("PAGE"===m){y.page=n.trim(),y.pageValue=parseFloat(n.replace(/^.*=/,"")),y.pageSymbol=y.page.replace(/=.*/,"");var D=v.symbol.indexOf(y.pageSymbol),E="";v.units&&v.units[D]&&(E=v.units[D]),w.indirectFrequency&&"PPM"!==E&&(y.pageValue/=w.indirectFrequency)}else"RETENTIONTIME"===m?y.pageValue=parseFloat(n):"XYDATA"===m?(f(w,y),n.match(/.*\+\+.*/)?h(y,n,w):g(y,n,w),x.push(y),y={}):"PEAKTABLE"===m?(f(w,y),g(y,n,w),x.push(y),y={}):d(m)?y[c(m)]=n:m.match(k)&&(w.info[m]=n.trim())}if(w.profiling&&w.profiling.push({action:"Finished parsing",time:new Date-u}),Object.keys(v).length>0){for(var F=[],G=Object.keys(v),p=0;p<G.length;p++)for(var H=G[p],I=v[H],J=0;J<I.length;J++)F[J]||(F[J]={}),F[J][H]=I[J];w.ntuples=F}if(w.twoD&&(j(w),w.profiling&&w.profiling.push({action:"Finished countour plot calculation",time:new Date-u}),i.keepSpectra||delete w.spectra),x.length>1&&(!x[0].dataType||x[0].dataType.toLowerCase().match(/.*mass./))&&(e(w),w.profiling&&w.profiling.push({action:"Finished GCMS calculation",time:new Date-u})),i.xy&&x.length>0)for(var p=0;p<x.length;p++){var y=x[p];if(y.data.length>0)for(var J=0;J<y.data.length;J++){for(var K=y.data[J],L={x:Array(K.length/2),y:Array(K.length/2)},M=0;M<K.length;M+=2)L.x[M/2]=K[M],L.y[M/2]=K[M+1];y.data[J]=L}}return w.profiling&&w.profiling.push({action:"Total time",time:new Date-u}),w}function c(a){return a.toLowerCase().replace(/[^a-z0-9]/g,"")}function d(a){for(var b=0;b<p.length;b++)if(a===p[b])return!0;return!1}function e(a){var b,d=a.spectra,e=[];for(b=0;b<p.length;b++){var f=c(p[b]);d[0][f]&&e.push(f)}if(0!==e.length){var g={};for(g.gc={},g.ms=[],b=0;b<e.length;b++)g.gc[e[b]]=[];for(b=0;b<d.length;b++){for(var h=d[b],i=0;i<e.length;i++)g.gc[e[i]].push(h.pageValue),g.gc[e[i]].push(parseFloat(h[e[i]]));h.data&&(g.ms[b]=h.data[0])}a.gcms=g}}function f(a,b){if(b.xFactor||(b.xFactor=1),b.yFactor||(b.yFactor=1),b.observeFrequency&&b.xUnit&&"HZ"===b.xUnit.toUpperCase()&&(b.xUnit="PPM",b.xFactor=b.xFactor/b.observeFrequency,b.firstX=b.firstX/b.observeFrequency,b.lastX=b.lastX/b.observeFrequency,b.deltaX=b.deltaX/b.observeFrequency),a.shiftOffsetVal){var c=b.firstX-a.shiftOffsetVal;b.firstX=b.firstX-c,b.lastX=b.lastX-c}}function g(a,b,c){a.isPeaktable=!0;var d,e,f,g,h,i=[];a.data=[i];var j=b.split(/,? *,?[;\r\n]+ */),k=0;for(d=1,e=j.length;e>d;d++)if(h=j[d].trim().replace(m,"").split(n),h.length%2===0)for(f=0,g=h.length;g>f;f+=2)i[k++]=parseFloat(h[f])*a.xFactor,i[k++]=parseFloat(h[f+1])*a.yFactor;else c.logs.push("Format error: "+h)}function h(a,b,c){a.deltaX||(a.deltaX=(a.lastX-a.firstX)/(a.nbPoints-1)),a.isXYdata=!0;var d=[];a.data=[d];var e,f,g,h=a.firstX,i=a.firstY,j=b.split(/[\r\n]+/);f=[];for(var k=1,n=j.length;n>k;k++)if(f=j[k].trim().replace(m,"").split(l),f.length>0){if(o){a.firstPoint||(a.firstPoint=parseFloat(f[0]));var p=parseFloat(f[0]-a.firstPoint)*a.xFactor+a.firstX;(e||0===e)&&(p+=a.deltaX),c.logs.push("Checking X value: currentX: "+h+" - expectedCurrentX: "+p)}for(var q=1,r=f.length;r>q;q++)if(1!==q||!e&&0!==e){if(f[q].length>0)if(g=f[q].charCodeAt(0),43===g||45===g||46===g||g>47&&58>g)e=null,i=parseFloat(f[q]),d.push(h,i*a.yFactor),h+=a.deltaX;else if(g>63&&74>g)e=null,i=parseFloat(String.fromCharCode(g-16)+f[q].substring(1)),d.push(h,i*a.yFactor),h+=a.deltaX;else if(g>96&&106>g)e=null,i=-parseFloat(String.fromCharCode(g-48)+f[q].substring(1)),d.push(h,i*a.yFactor),h+=a.deltaX;else if(g>82&&91>g||115===g){var s=parseFloat(String.fromCharCode(g-34)+f[q].substring(1))-1;115===g&&(s=parseFloat("9"+f[q].substring(1))-1);for(var t=0;s>t;t++)e&&(i+=e),d.push(h,i*a.yFactor),h+=a.deltaX}else 37===g?(e=parseFloat("0"+f[q].substring(1)),i+=e,d.push(h,i*a.yFactor),h+=a.deltaX):g>73&&83>g?(e=parseFloat(String.fromCharCode(g-25)+f[q].substring(1)),i+=e,d.push(h,i*a.yFactor),h+=a.deltaX):g>105&&115>g&&(e=-parseFloat(String.fromCharCode(g-57)+f[q].substring(1)),i+=e,d.push(h,i*a.yFactor),h+=a.deltaX)}else e=null,g=f[q].charCodeAt(0)}}function i(a){for(var b=0,c=a[0].data[0][0],d=c,e=a.length,f=a[0].data[0].length/2,g=new Array(e),h=0;e>h;h++){g[h]=new Array(f);for(var i=0;f>i;i++)g[h][i]=a[h].data[0][2*i+1],g[h][i]<c&&(c=a[h].data[0][2*i+1]),g[h][i]>d&&(d=a[h].data[0][2*i+1]),0!==h&&0!==i&&(b+=Math.abs(g[h][i]-g[h][i-1])+Math.abs(g[h][i]-g[h-1][i]))}return{z:g,minX:a[0].data[0][0],maxX:a[0].data[0][a[0].data[0].length-2],minY:a[0].pageValue,maxY:a[e-1].pageValue,minZ:c,maxZ:d,noise:b/((e-1)*(f-1)*2)}}function j(a){var b=i(a.spectra);a.contourLines=k(b),delete b.z,a.minMax=b}function k(a,b){for(var c,d,e,f,g,h=a.noise,i=a.z,j=[],k=7,l=new Float32Array(4),m=[],n=i.length,o=i[0].length,p=a.minX,q=a.maxX,r=(q-p)/(o-1),s=a.minY,t=a.maxY,u=(t-s)/(n-1),v=a.minZ,w=a.maxZ,x=0;2*k>x;x++){var y={};j.push(y);var z=x%2;g=0===z?(w-5*h)*Math.exp(x/2-k)+5*h:-(w-5*h)*Math.exp(x/2-k)-5*h;var A=[];if(y.zValue=g,y.lines=A,!(v>=g||g>=w))for(var B=0;n-1>B;B++)for(var C=0;o-1>C;C++){l[0]=i[B][C],l[1]=i[B][C+1],l[2]=i[B+1][C],l[3]=i[B+1][C+1];for(var D=0;4>D;D++)m[D]=l[D]>g;m[0]!==m[1]&&m[0]!==m[2]&&(c=C+(g-l[0])/(l[1]-l[0]),d=B,e=C,f=B+(g-l[0])/(l[2]-l[0]),A.push(c*r+p,d*u+s,e*r+p,f*u+s)),m[3]!==m[1]&&m[3]!==m[2]&&(c=C+1,d=B+1-(g-l[3])/(l[1]-l[3]),e=C+1-(g-l[3])/(l[2]-l[3]),f=B+1,A.push(c*r+p,d*u+s,e*r+p,f*u+s)),m[1]!==m[2]&&(c=C+1-(g-l[1])/(l[2]-l[1]),d=B+(g-l[1])/(l[2]-l[1]),m[1]!==m[0]&&(e=C+1-(g-l[1])/(l[0]-l[1]),f=B,A.push(c*r+p,d*u+s,e*r+p,f*u+s)),m[2]!==m[0]&&(e=C,f=B+1-(g-l[2])/(l[0]-l[2]),A.push(c*r+p,d*u+s,e*r+p,f*u+s)),m[1]!==m[3]&&(e=C+1,f=B+(g-l[1])/(l[3]-l[1]),A.push(c*r+p,d*u+s,e*r+p,f*u+s)),m[2]!==m[3]&&(e=C+(g-l[2])/(l[3]-l[2]),f=B+1,A.push(c*r+p,d*u+s,e*r+p,f*u+s)))}}return{minX:a.minX,maxX:a.maxX,minY:a.minY,maxY:a.maxY,segments:j}}var l=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,m=/\$\$.*/,n=/[,\t ]+/,o=!1,p=["TIC",".RIC","SCANNUMBER"];return b}function e(a,b,c){return"boolean"==typeof b&&(c=b,b={}),c?f(a,b):i(a,b)}function f(a,b){return h||g(),new Promise(function(c){var d=Date.now()+""+Math.random();j[d]=c,h.postMessage({stamp:d,input:a,options:b})})}function g(){var a=URL.createObjectURL(new Blob(["var getConverter ="+d.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));h=new Worker(a),URL.revokeObjectURL(a),h.addEventListener("message",function(a){var b=a.data.stamp;j[b]&&j[b](a.data.output)})}var h,i=d(),j={};b.exports={convert:e}},{}],6:[function(a,b,c){var d;!function e(b,c,d){function f(h,i){if(!c[h]){if(!b[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw new Error("Cannot find module '"+h+"'")}var k=c[h]={exports:{}};b[h][0].call(k.exports,function(a){var c=b[h][1][a];return f(c?c:a)},k,k.exports,e,b,c,d)}return c[h].exports}for(var g="function"==typeof a&&a,h=0;h<d.length;h++)f(d[h]);return f}({1:[function(a,b,c){function d(a,b){var c=document,d=a.nodeType||a===window?a:c.createElement(a),f=[];b&&(d.className=b);var g=e(),h=e(),i=function(a,b){d.addEventListener?d.addEventListener(a,b,!1):d.attachEvent("on"+a,b),f.push({event:a,handler:b})},j=function(a,b){d.removeEventListener?d.removeEventListener(a,b):d.detachEvent("on"+a,b);for(var c,e=f.length;e-->0;)if(c=f[e],c.event===a&&c.handler===b){f.splice(e,1);break}},k=function(a){var b=!1,c=function(c){b||(b=!0,setTimeout(function(){b=!1},100),a(c))};i("touchstart",c),i("mousedown",c)},l=function(a){d&&(d.style.display="block",g.fire(a))},m=function(a){d&&(d.style.display="none",h.fire(a))},n=function(){return d.style&&"block"===d.style.display},o=function(a){d&&(d.innerHTML=a)},p=function(a){d&&(o(""),d.appendChild(c.createTextNode(a)))},q=function(){if(d.parentNode){for(var a,b=f.length;b-->0;)a=f[b],j(a.event,a.handler);d.parentNode.removeChild(d),g.removeAllListeners(),h.removeAllListeners()}},r=function(a){var b=a.el||a;d.appendChild(b)};return{el:d,addListener:i,addClickListener:k,onShowEvent:g,onHideEvent:h,show:l,hide:m,isShowing:n,html:o,text:p,remove:q,add:r}}var e=a("./ModalEvent");b.exports=d},{"./ModalEvent":3}],2:[function(a,b,c){function d(a,b,c,f,g){if(void 0!==a){b=b||{};var h,i=e("div","nanoModal nanoModalOverride "+(b.classes||"")),j=e("div","nanoModalContent"),k=e("div","nanoModalButtons");i.add(j),i.add(k),i.el.style.display="none";var l,m=[];b.buttons=b.buttons||[{text:"Close",handler:"hide",primary:!0}];var n=function(){for(var a=m.length;a-->0;){var b=m[a];b.remove()}m=[]},o=function(){i.el.style.marginLeft=-i.el.clientWidth/2+"px"},p=function(){for(var a=document.querySelectorAll(".nanoModal"),b=a.length;b-->0;)if("none"!==a[b].style.display)return!0;return!1},q=function(){i.isShowing()||(d.resizeOverlay(),c.show(c),i.show(l),o())},r=function(){i.isShowing()&&(i.hide(l),p()||c.hide(c),b.autoRemove&&l.remove())},s=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};return l={modal:i,overlay:c,show:function(){return f?f(q,l):q(),l},hide:function(){return g?g(r,l):r(),l},onShow:function(a){return i.onShowEvent.addListener(function(){a(l)}),l},onHide:function(a){return i.onHideEvent.addListener(function(){a(l)}),l},remove:function(){c.onRequestHide.removeListener(h),h=null,n(),i.remove()},setButtons:function(a){var b,c,d,f=a.length,g=function(a,b){var c=s(l);a.addClickListener(function(a){c.event=a||window.event,b.handler(c)})};if(n(),0===f)k.hide();else for(k.show();f-->0;)b=a[f],d="nanoModalBtn",b.primary&&(d+=" nanoModalBtnPrimary"),d+=b.classes?" "+b.classes:"",c=e("button",d),"hide"===b.handler?c.addClickListener(l.hide):b.handler&&g(c,b),c.text(b.text),k.add(c),m.push(c);return o(),l},setContent:function(b){return b.nodeType?(j.html(""),j.add(b)):j.html(b),o(),a=b,l},getContent:function(){return a}},h=c.onRequestHide.addListener(function(){b.overlayClose!==!1&&i.isShowing()&&l.hide()}),l.setContent(a).setButtons(b.buttons),document.body.appendChild(i.el),l}}var e=a("./El"),f=document,g=function(a){var b=f.documentElement,c="scroll"+a,d="offset"+a;return Math.max(f.body[c],b[c],f.body[d],b[d],b["client"+a])};d.resizeOverlay=function(){var a=f.getElementById("nanoModalOverlay");a.style.width=g("Width")+"px",a.style.height=g("Height")+"px"},b.exports=d},{"./El":1}],3:[function(a,b,c){function d(){var a={},b=0,c=function(c){return a[b]=c,b++},d=function(b){b&&delete a[b]},e=function(){a={}},f=function(){for(var c=0,d=b;d>c;++c)a[c]&&a[c].apply(null,arguments)};return{addListener:c,removeListener:d,removeAllListeners:e,fire:f}}b.exports=d},{}],4:[function(a,b,c){var e=a("./ModalEvent"),f=function(){function b(){if(!g.querySelector("#nanoModalOverlay")){var a=d("style"),b=a.el,h=g.querySelectorAll("head")[0].childNodes[0];h.parentNode.insertBefore(b,h);var i=".nanoModal{position:absolute;top:100px;left:50%;display:none;z-index:9999;min-width:300px;padding:15px 20px 10px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;background:#fff;background:-moz-linear-gradient(top,#fff 0,#ddd 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#fff),color-stop(100%,#ddd));background:-webkit-linear-gradient(top,#fff 0,#ddd 100%);background:-o-linear-gradient(top,#fff 0,#ddd 100%);background:-ms-linear-gradient(top,#fff 0,#ddd 100%);background:linear-gradient(to bottom,#fff 0,#ddd 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#dddddd', GradientType=0)}.nanoModalOverlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:9998;background:#000;display:none;-ms-filter:\"alpha(Opacity=50)\";-moz-opacity:.5;-khtml-opacity:.5;opacity:.5}.nanoModalButtons{border-top:1px solid #ddd;margin-top:15px;text-align:right}.nanoModalBtn{color:#333;background-color:#fff;display:inline-block;padding:6px 12px;margin:8px 4px 0;font-size:14px;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:1px solid transparent;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}.nanoModalBtn:active,.nanoModalBtn:focus,.nanoModalBtn:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.nanoModalBtn.nanoModalBtnPrimary{color:#fff;background-color:#428bca;border-color:#357ebd}.nanoModalBtn.nanoModalBtnPrimary:active,.nanoModalBtn.nanoModalBtnPrimary:focus,.nanoModalBtn.nanoModalBtnPrimary:hover{color:#fff;background-color:#3071a9;border-color:#285e8e}";b.styleSheet?b.styleSheet.cssText=i:a.text(i),c=d("div","nanoModalOverlay nanoModalOverride"),c.el.id="nanoModalOverlay",g.body.appendChild(c.el),c.onRequestHide=e();var j=function(){c.onRequestHide.fire()};c.addClickListener(j),d(g).addListener("keydown",function(a){var b=a.which||a.keyCode;27===b&&j()});var k,l=d(window);l.addListener("resize",function(){k&&clearTimeout(k),k=setTimeout(f.resizeOverlay,100)}),l.addListener("orientationchange",function(){for(var a=0;3>a;++a)setTimeout(f.resizeOverlay,1e3*a+200)})}}var c,d=a("./El"),f=a("./Modal"),g=document;document.body&&b();var h=function(a,d){return b(),f(a,d,c,h.customShow,h.customHide)};return h.resizeOverlay=f.resizeOverlay,h}();d=f},{"./El":1,"./Modal":2,"./ModalEvent":3}]},{},[1,2,3,4]),"undefined"!=typeof window&&("function"==typeof window.define&&window.define.amd&&window.define(function(){return d}),window.nanoModal=d),"undefined"!=typeof b&&(b.exports=d)},{}],7:[function(a,b,c){!function(){function a(a){return a&&0==a.lastIndexOf("http",0)&&-1==a.lastIndexOf(window.location.host)}function b(b,c){var d=b.querySelectorAll("image"),e=d.length;0==e&&c();for(var f=0;f<d.length;f++)!function(b){var d=b.getAttribute("xlink:href");if(d&&a(d.value))return void console.warn("Cannot render embedded images linking to external hosts: "+d.value);var f=document.createElement("canvas"),g=f.getContext("2d"),h=new Image;d=d||b.getAttribute("href"),h.src=d,h.onload=function(){f.width=h.width,f.height=h.height,g.drawImage(h,0,0),b.setAttribute("xlink:href",f.toDataURL("image/png")),e--,0==e&&c()},h.onerror=function(){console.log("Could not load "+d),e--,0==e&&c()}}(d[f])}function d(b,c){for(var d="",e=document.styleSheets,f=0;f<e.length;f++)if(a(e[f].href))console.warn("Cannot include styles from other hosts: "+e[f].href);else{var g=e[f].cssRules;if(null!=g)for(var h=0;h<g.length;h++){var i=g[h];if("undefined"!=typeof i.style){var j=null;try{j=b.querySelector(i.selectorText)}catch(k){console.warn('Invalid CSS selector "'+i.selectorText+'"',k)}if(j){var l=c?c(i.selectorText):i.selectorText;d+=l+" { "+i.style.cssText+" }\n"}else i.cssText.match(/^@font-face/)&&(d+=i.cssText+"\n")}}}return d}var e="undefined"!=typeof c&&c||this,f='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';e.svgAsDataUri=function(a,c,g){c=c||{},c.scale=c.scale||1;var h="http://www.w3.org/2000/xmlns/";b(a,function(){var b,i,j=document.createElement("div"),k=a.cloneNode(!0);if("svg"==a.tagName)b=parseInt(k.getAttribute("width")||k.style.width||e.getComputedStyle(a).getPropertyValue("width")),i=parseInt(k.getAttribute("height")||k.style.height||e.getComputedStyle(a).getPropertyValue("height"));else{var l=a.getBBox();b=l.x+l.width,i=l.y+l.height,k.setAttribute("transform",k.getAttribute("transform").replace(/translate\(.*?\)/,""));var m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.appendChild(k),k=m}k.setAttribute("version","1.1"),k.setAttributeNS(h,"xmlns","http://www.w3.org/2000/svg"),k.setAttributeNS(h,"xmlns:xlink","http://www.w3.org/1999/xlink"),k.setAttribute("width",b*c.scale),k.setAttribute("height",i*c.scale),k.setAttribute("viewBox","0 0 "+b+" "+i),j.appendChild(k);var n=d(a,c.selectorRemap),o=document.createElement("style");o.setAttribute("type","text/css"),o.innerHTML="<![CDATA[\n"+n+"\n]]>";var p=document.createElement("defs");p.appendChild(o),k.insertBefore(p,k.firstChild);var m=f+j.innerHTML,q="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(m)));g&&g(q)})},e.saveSvgAsPng=function(a,b,c){c=c||{},e.svgAsDataUri(a,c,function(a){var c=new Image;c.src=a,c.onload=function(){var a=document.createElement("canvas");a.width=c.width,a.height=c.height;var d=a.getContext("2d");d.drawImage(c,0,0);var e=document.createElement("a");e.download=b,e.href=a.toDataURL("image/png"),document.body.appendChild(e),e.addEventListener("click",function(a){e.parentNode.removeChild(e)}),e.click()}})}}()},{}],8:[function(a,b,c){function d(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function e(a,b,c){var d,e=b.x,f=b.y,g=c.x-e,h=c.y-f;return(0!==g||0!==h)&&(d=((a.x-e)*g+(a.y-f)*h)/(g*g+h*h),d>1?(e=c.x,f=c.y):d>0&&(e+=g*d,f+=h*d)),g=a.x-e,h=a.y-f,g*g+h*h}function f(a,b){var c,e,f=a.length,g=a[0],h=[g];for(c=1;f>c;c++)e=a[c],d(e,g)>b&&(h.push(e),g=e);return g!==e&&h.push(e),h}function g(a,b){var c,d,f,g,h=a.length,i=typeof Uint8Array!=void 0+""?Uint8Array:Array,j=new i(h),k=0,l=h-1,m=[],n=[],o=[];for(j[k]=j[l]=1;l;){for(d=0,c=k+1;l>c;c++)f=e(a[c],a[k],a[l]),f>d&&(g=c,d=f);d>b&&(j[g]=1,m.push(k),n.push(g),m.push(g),n.push(l)),k=m.pop(),l=n.pop()}for(c=0;h>c;c++)j[c]&&o.push(a[c]);return o}function h(a,b,c){var d=void 0!==b?b*b:1;return c||(a=f(a,d)),a=g(a,d)}b.exports=h},{}],9:[function(a,b,c){function d(a,b){for(var c=[],d=0,e=0,f=0,g=0;g<a.length;g++)e+=a[g].x,f+=a[g].y,d++,d===b&&(c.push({x:e/d,y:f/d}),d=e=f=0);return d>0&&c.push({x:e/d,y:f/d}),c}b.exports=function(a,b){var c=Math.abs(a.range().x[0]-a.range().x[1]),e=c/b,f=Math.floor(a.datum().length/e),g=d(a.datum(),f);console.log(g),a.datum(g)}},{}],10:[function(a,b,c){b.exports=function(){function b(a,b,c){var d;if(c){var e=[b(a-10),b(a+10)];d=e[0]+g.slice(e[0],e[1]+1).whichMax()}else d=b(a);return g[d];
}function c(){var a=".line."+j;h.on("regionchange"+a,null),h.on("mouseenter"+a,null),h.on("mouseleave"+a,null),h.on("mousemove"+a,null),k&&(h.on("regionchange"+a,i.on("_regionchange")),h.on("mouseenter"+a,function(){d.show(!0)}),h.on("mouseleave"+a,function(){d.show(!1)}),l&&h.on("mousemove"+a,i.on("_mousemove"))),h.on("specDataChange"+a,function(a){a===d.parent()&&d.datum(a.datum())}),h.on("crosshairEnable"+a,d.enable)}function d(a){return e=d.xScale(),f=d.yScale(),h=d.dispatcher(),j=++h.idx,k=l=!0,i=o(a).datum(null).call(m),i.append("circle").attr("class","clr"+a.lineIdx()).attr("r",4.5).on("click",function(){a.selected(!a.selected())}).on("mouseenter",function(){a.parent().highlightSpec(a)}).on("mouseleave",function(){a.parent().highlightSpec()}),i.on("_regionchange",function(a){if(a.xdomain)i.datum(null),i.attr("transform","translate(-10000,-10000)"),m.hide();else{var b=i.datum();b&&(i.attr("transform","translate("+e(b.x)+","+f(b.y)+")"),m.show(i.node()))}}).on("_mousemove",function(c){var d=b(c.xcoor,a.pixelToi,c.shiftKey);return"undefined"==typeof d?void i.datum(null):(i.datum(d).attr("transform","translate("+e(d.x)+","+f(d.y)+")"),void m.text(d3.round(d.x,3)).show(i.node()))}).on("remove",function(){d.enabled(!1),h.on("crosshairEnable.line."+j,null),g=null,m.destroy()}),c(),i}var e,f,g,h,i,j,k,l,m=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0),n=a("../elem"),o=n.SVGElem()["class"]("crosshair");return n.inherit(d,o),d.show=function(a){return arguments.length?(l=a,i?(i.style("display",a?null:"none"),a?m.show(i):m.hide(),c(),d):d):l},d.enable=function(a){return arguments.length?(k=a,d.show(a)):k},d.datum=function(a){return arguments.length?(g=a,d):g},d}},{"../elem":22}],11:[function(a,b,c){function d(a){var b=a.map(function(a){return a.y}).cumsum(),c=a.map(function(a,c){return{x:a.x,y:b[c]}});return c}b.exports=function(){function b(a){function c(){k.datum(i).attr("d",m),d()}function d(){var a=k.node().getPointAtLength(.5*k.node().getTotalLength());s.attr("transform","translate("+a.x+","+a.y+")"),n()}function n(){l.datum(o).text((o/p).toFixed(2));var a=l.node().getBBox();l.attr("dx",-a.width/2),r()}function r(){var a=l.node().getBBox();t.attr("width",a.width+4).attr("height",a.height+4).attr("x",a.x-2).attr("y",a.y-2)}f=b.xScale(),g=b.yScale(),h=b.dispatcher(),j=e(a),b.updateData(),p||(p=o),q||(q=1),m=d3.svg.line().x(function(a){return f(a.x)}).y(function(a){return g(a.y/q)-.3*g.range()[0]}),k=j.append("path").attr("class","line");var s=j.append("g").attr("class","integration-text"),t=s.append("rect");l=s.append("text");var u=b.parentApp().modals();s.on("mouseenter",function(){j.classed("highlight",!0)}).on("mouseleave",function(){j.classed("highlight",!1)}).on("click",d3.contextMenu([{title:"Set integral",action:u.input("Set Integral to: ",l.text(),function(a){p=l.datum()/a,h.integ_refactor(p)})}])),c(),j.on("_redraw",function(a){a.x&&c()}).on("_refactor",function(a){b.integFactor(a),n()}).on("_reduction_factor",function(a){b.reductionFactor(a),c()});var v=++h.idx;h.on("redraw.integ."+v,j.on("_redraw")),h.on("integ_refactor."+v,j.on("_refactor")),h.on("specDataChange.integ."+v,function(a){a===b.parent()&&(p===o?(b.updateData(),p=o,h.integ_refactor(p)):b.updateData())})}var c=a("../elem"),e=c.SVGElem()["class"]("integration");c.inherit(b,e);var f,g,h,i,j,k,l,m,n,o,p,q;return b.segment=function(a){return arguments.length?(n=a,b.updateData()):n},b.updateData=function(){if(!n||!j)return o=void 0,b;var a=b.parent();return i=d(Array.prototype.slice.apply(a.datum(),n)),o=i[i.length-1].y,b},b.integFactor=function(a){return arguments.length?(p=a,b):p},b.integValue=function(a){return arguments.length?(o=a,b):o},b.reductionFactor=function(a){return arguments.length?(q=a,b.sel()&&b.sel().on("_redraw")({x:!0}),b):q},b}},{"../elem":22}],12:[function(a,b,c){function d(a){for(var b=[],c=a.spectra(),d=0;d<c.length;d++)b=b.concat(c[d].segments(!0).map(function(a){return a.integValue()}));var e=d3.max(b)/(.5*a.yScale().domain()[1]);return a.spectra().forEach(function(a){a.segments(!0).forEach(function(a){a.reductionFactor(e)})}),d3.max(b)/.5}function e(a){for(var b,c=a.spectra(),d=0;d<c.length;d++)for(var e=c[d].segments(),f=0;f<e.length;f++)if(b=e[f].integFactor())return b}b.exports=function(){function b(a){o=b.xScale(),p=b.yScale(),q=b.dispatcher(),t=o.copy(),r=a.spectra().indexOf(b),s=j(a).classed("selected",x).classed("clr"+r,!0),i.datum(k).xScale(o).yScale(p).simplify(1)["class"]("line")(s),"undefined"==typeof n&&b.crosshair(!0),n&&n.xScale(o).yScale(p).dispatcher(q)(b);for(var e=0;e<A.length;e++)c(A[e]);s.on("_redraw",function(b){if(b.x)i.redraw().sel().attr("transform","scale(1,1)translate(0,0)"),d(a);else{var c=p.copy().domain(a.range().y),e=[0,-Math.min(c(p.domain()[1]),c(p.domain()[0]))],f=[1,Math.abs((a.range().y[0]-a.range().y[1])/(p.domain()[0]-p.domain()[1]))];i.sel().attr("transform","scale("+f+")translate("+e+")")}}).on("_regionchange",function(a){if(a.xdomain){var c=a.xdomain.map(b.ppmToi);if(t.domain(c).range(c.map(function(a){return o(k[a].x)})),v&&c[0]===v[0]&&c[1]===v[1])return;v=c,g(),w.y=i.range().y,w.y[0]*=y,w.y[1]*=y}}).on("_integrate",function(a){var c=a.xdomain.map(b.ppmToi).sort(d3.ascending);b.addSegment(c)}).on("_segment",function(){});var f=++q.idx;return q.on("regionchange.line."+f,s.on("_regionchange")),q.on("redraw.line."+f,s.on("_redraw")),q.on("integrate.line."+f,s.on("_integrate")),s.on("remove",function(){q.on("regionchange.line."+f,null),q.on("redraw.line."+f,null),q.on("integrate.line."+f,null),k=null,n&&n.remove()}),s}function c(a){s&&a.xScale(o).yScale(p).dispatcher(q)(b)}function f(a,b){s&&s.on("_redraw")({x:a,y:b})}function g(){s&&(i.datum(Array.prototype.slice.apply(k,v)),s.on("_redraw")({x:!0}))}var h=a("../elem"),i=a("./path-simplify")(),j=h.SVGElem()["class"]("spec-line");h.inherit(b,j);var k,l,m,n,o,p,q,r,s,t,u,v,w={},x=!0,y=1,z=[],A=h.ElemArray();return b.addSegment=function(f){var g=a("./integration-elem")().segment(f).integFactor(e(b.parent()));A.push(g),c(g),d(b.parent())},b.delSegment=function(a){A=A.filter(function(b){return!(b>=a[0]&&b<=a[1])})},b.segments=function(a){var b=A;return a&&(b=b.filter(function(a){var b=a.segment();return b[0]>v[0]&&b[0]<v[1]&&b[1]>v[0]&&b[1]<v[1]})),b},b.addPeaks=function(a){z=z.concat(a)},b.delPeaks=function(a){a=a.map(b.ppmToi).sort(d3.ascending),z=z.filter(function(b){return!(b>=a[0]&&b<=a[1])})},b.peaks=function(a){var b=z;return a&&(b=b.filter(function(a){return a>v[0]&&a<v[1]})),k.subset(b)},b.iToPixel=function(a){return t(a)},b.pixelToi=function(a){return Math.round(t.invert(a))},b.ppmToi=function(a){console.log("ppm",a);var b=Math.round(u(a));return b=b>k.length-1?k.length-1:b,b=0>b?0:b,k[b-1]&&Math.abs(a-k[b].x)>Math.abs(a-k[b-1].x)?b--:k[b+1]&&Math.abs(a-k[b].x)>Math.abs(a-k[b+1].x)&&b++,b},b.range=function(){return w},b.datum=function(a){if(!arguments.length)return k;if(a[0].x)k=a;else if(k&&k.length===a.length)k=a.map(function(a,b){return{x:k[b].x,y:a}});else{var c=d3.scale.linear().range(b.parent().range().x).domain([0,a.length]);k=a.map(function(a,b){return{x:c(b),y:a}})}return w.x=[k[0].x,k[k.length-1].x],w.y=d3.extent(k.map(function(a){return a.y})),u=d3.scale.linear().range([0,k.length]).domain([k[0].x,k[k.length-1].x]),q&&q.specDataChange(b),g(),b},b.label=function(a){return arguments.length?(m=a,b):m},b.crosshair=function(c){return arguments.length?(n=c?a("./crosshair")().datum(k):!1,b):n},b.s_id=function(a){return arguments.length?(l=a,b):l},b.selected=function(a){return arguments.length?(x=a,s&&s.classed("selected",a),b):x},b.lineIdx=function(){return r},b.scaleFactor=function(a){return arguments.length?(y=a,f(),b):y},b}},{"../elem":22,"./crosshair":10,"./integration-elem":11,"./path-simplify":14}],13:[function(a,b,c){b.exports=function(){function b(){if(l.empty())return h&&i?l.extent([[0,0],[0,0]]):l.extent([0,0]),k.call(l),null;var a={};return h&&i?(a.xdomain=[l.extent()[1][0],l.extent()[0][0]],a.ydomain=[l.extent()[1][1],l.extent()[0][1]]):(a.xdomain=h?l.extent().reverse():null,a.ydomain=i?l.extent():null),l.clear(),k.call(l),a}function c(){var a=b();a&&g.parent().changeRegion(a)}function d(){var a=b();a&&j.peakdel(a)}function e(){var a=b();a&&j.integrate(a)}function f(){l.clear(),k.call(l)}function g(a){h=g.xScale(),i=g.yScale(),j=g.dispatcher(),l=d3.svg.brush().x(h).y(i).on("brushend",c),k=n(a).call(l),k.selectAll("rect").attr("height",a.height()),k.select(".background").style("cursor",null).style("pointer-events","all"),k.on("peakpickEnable",function(a){k.classed("peakpick-brush",a),g.parent().sel().classed("peakpick-brush",a),l.on("brushend",a?f:c)}).on("peakdelEnable",function(a){k.classed("peakdel-brush",a),g.parent().sel().classed("peakdel-brush",a),l.on("brushend",a?d:c)}).on("integrateEnable",function(a){k.classed("integrate-brush",a),g.parent().sel().classed("integrate-brush",a),l.on("brushend",a?e:c)});var b=++j.idx;return j.on("peakpickEnable.brush."+b,k.on("peakpickEnable")),j.on("peakdelEnable.brush."+b,k.on("peakdelEnable")),j.on("integrateEnable.brush."+b,k.on("integrateEnable")),k}var h,i,j,k,l,m=a("../elem"),n=m.SVGElem()["class"]("main-brush");return m.inherit(g,n),g}},{"../elem":22}],14:[function(a,b,c){var d=a("../utils/simplify-line");b.exports=function(){function b(a){return h=b.xScale(),i=b.yScale(),m=d3.svg.line().interpolate("linear").x(function(a){return h(a.x)}).y(function(a){return i(a.y)}),j=f(a)}function c(){n.x=[k[0].x,k[k.length-1].x],n.y=d3.extent(k.map(function(a){return a.y}))}var e=a("../elem"),f=e.ResponsiveElem("path");e.inherit(b,f);var g,h,i,j,k,l,m,n={};return b.redraw=function(){return j?(g.length<2?j.attr("d",null):j.attr("d",m),b):b},b.update=function(){return j?(console.log("data length",g.length),g.length<2?(j.datum(null),b):(l?(k=d(g,h,l),console.log("simplify",k.length)):k=g,j.datum(k),c(),b)):b},b.range=function(){return n},b.datum=function(a){return arguments.length?(g=a,b.update()):g},b.simplify=function(a){return arguments.length?(l=a,b):l},b}},{"../elem":22,"../utils/simplify-line":50}],15:[function(a,b,c){function d(a,b,c){var d=Math.max(b-10,60);return d3.svg.line().defined(function(a){return!isNaN(a[1])})([[c,40],[a,60],[a,80],[NaN,NaN],[a,d-10],[a,d]])}function e(a,b,c){for(var d=b,e=c-d,f=0;f<a.length;f++)a[f].pos>e&&(a[f].pos=e),e=a[f].pos-d;if(d>e)for(e=d,f=a.length-1;f>=0&&a[f].pos<e;f--)a[f].pos=e,e=a[f].pos+d;return a}function f(a){for(var b=a.spectra(),c=a.xScale(),d=[],e=0;e<b.length;e++){var f=b[e].peaks(!0).map(function(a){return{line:b[e].lineIdx(),pos:c(a.x),d:a}});d=d.concat(f)}return d=d.sort(function(a,b){return d3.descending(a.pos,b.pos)})}var g=a("d3-context-menu")(d3);b.exports=function(){function b(){var a=l.selectAll("text").data(q);a.enter().append("text").attr("dy","0.35em").attr("focusable",!0).on("focus",function(){}),a.exit().remove()}function c(){var a=l.selectAll("path").data(q);a.enter().append("path").style("fill","none"),a.exit().remove()}function h(){l.selectAll("text").text(function(a){return d3.round(a.d.x,3)}).attr("transform",function(a){return"translate("+a.pos+",0)rotate(90)"}).attr("class",function(a){return"peak-text clr"+a.line}).on("keydown",function(a){68===d3.event.keyCode&&o.peakdel({xdomain:[a.d.x,a.d.x]})}).on("click",g(p))}function i(){l.selectAll("path").attr("d",function(a){return d(m(a.d.x),n(a.d.y),a.pos)}).attr("class",function(a){return"peak-line clr"+a.line})}function j(){var a=l.append("text").text("any"),b=a.node().getBBox().height;return a.remove(),b}function k(a){m=k.xScale(),n=k.yScale(),o=k.dispatcher();var d=a.width();l=s(a),l.on("_click",function(b){var c=a.spectra();c.forEach(function(a){if(a.crosshair()){a.crosshair().sel().on("_mousemove")(b);var c=a.crosshair().sel().datum();c&&(console.log(c,a.ppmToi(c.x)),a.addPeaks(a.ppmToi(c.x)))}else a.addPeaks(a.pixelToi(b.xcoor))}),o.peakpick()}).on("_regionchange",function(b){b.xdomain&&(q=f(a),q=e(q,j(),d))}).on("_redraw",function(a){if(a.x){if(b(),c(),0===q.length)return;h()}i()}).on("_peakpick",function(){l.on("_regionchange")({xdomain:!0}),l.on("_redraw")({x:!0,y:!0})}).on("_peakdel",function(b){b.xdomain&&a.spectra().forEach(function(a){a.delPeaks(b.xdomain)}),b.ydomain,o.peakpick()});var g=++o.idx;return o.on("regionchange.peaks."+g,l.on("_regionchange")),o.on("redraw.peaks."+g,l.on("_redraw")),o.on("peakpickEnable.peaks."+g,function(a){o.on("click.peaks."+g,a?l.on("_click"):null)}),o.on("peakpick.peaks."+g,l.on("_peakpick")),o.on("peakdel.peaks."+g,l.on("_peakdel")),l}var l,m,n,o,p=[{title:"Delete peak",action:function(a,b){k.parent().spectra().filter(function(a){return a.lineIdx()===b.line})[0].delPeaks([b.d.x,b.d.x]),o.peakpick()}}],q=[],r=a("../elem"),s=r.SVGElem()["class"]("peaks");return r.inherit(k,s),k.peaks=function(){return f(k.parent())},k}},{"../elem":22,"d3-context-menu":4}],16:[function(a,b,c){b.exports=function(){function b(a){e=b.xScale(),f=b.yScale(),g=b.dispatcher();var i=e?e:f;h=e?e.copy():f.copy();var k=d3.svg.axis().scale(h).orient(e?"bottom":"top").tickFormat(d3.format("s")),l=d3.svg.brush().x(h).on("brushstart",function(){d3.event.sourceEvent.stopPropagation()}).on("brushend",function(){var b=l.empty()?h.domain():l.extent().reverse();b=b.sort(h.domain()[0]>h.domain()[1]?d3.descending:d3.ascending),a.changeRegion(e?{xdomain:b}:{ydomain:b})});d=j(a).classed(e?"x":"y",!0).attr("transform",e?"translate(0,-20)":"translate(-20,0)rotate(90)"),d.append("g").call(k).attr("class","brush-axis"),d.append("g").attr("class","brush").call(l).selectAll("rect").attr("y",-5).attr("height",10),d.select(".background").style("pointer-events","all"),d.on("_rangechange",function(a){(a.x||a.y&&f)&&(h.domain(e?a.x:a.y),d.select(".brush-axis").call(k),d.select(".brush").call(l))}).on("_regionchange",function(a){if(a.xdomain||a.ydomain&&f){var b=c(i.domain(),h.domain());l.extent(b)}}).on("_redraw",function(a){(a.x||a.y&&f)&&d.select(".brush").call(l)});var m=++g.idx;return g.on("rangechange.scalebrush."+m,d.on("_rangechange")),g.on("regionchange.scalebrush."+m,d.on("_regionchange")),g.on("redraw.scalebrush."+m,d.on("_redraw")),d}function c(a,b){var c=[0,0];return a[0]>a[1]?(c[0]=Math.min(a[0],b[0]),c[1]=Math.max(a[1],b[1])):(c[0]=Math.max(a[0],b[0]),c[1]=Math.min(a[1],b[1])),c.join()===b.join()&&(c=[0,0]),c}var d,e,f,g,h,i=a("../elem"),j=i.SVGElem()["class"]("scale-brush");return i.inherit(b,j),b}},{"../elem":22}],17:[function(a,b,c){b.exports=function(){function b(a){h=b.xScale(),i=b.yScale(),j=b.dispatcher(),g=f(a).attr("pointer-events","all").attr("clip-path","url(#"+a.clipId()+")").attr("width",b.width()).attr("height",b.height()).call(r).on("dblclick.zoom",null).on("mousedown.zoom",null),g.append("rect").attr("width",b.width()).attr("height",b.height()).style("fill","none"),g.on("_redraw",function(a){j.redraw(a)}).on("_regionchange",function(a){if(a.xdomain&&h.domain(a.xdomain),j.regionchange({xdomain:a.xdomain}),a.ydomain)i.domain(a.ydomain),a.zoom||r.scale((m.y[0]-m.y[1])/(i.domain()[0]-i.domain()[1]));else{var c=b.spectra(!0);0===c.length&&(c=n);var d=d3.min(c.map(function(a){return a.range().y[0]})),e=d3.max(c.map(function(a){return a.range().y[1]})),f=e-d;d-=.05*f,e+=.05*f,m.y=[d,e],i.domain(m.y),j.rangechange({y:m.y}),r.scale(1)}j.regionchange({ydomain:i.domain()}),g.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(m.x=a.x),a.y&&(m.y=a.y),j.rangechange(a),a.norender||g.on("_regionchange")({xdomain:m.x,ydomain:m.y})}),b.parentApp().config()>1&&g.on("mouseenter",j.mouseenter).on("mouseleave",j.mouseleave).on("mousemove",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],j.mousemove(a)}).on("mousedown",function(){var a=new Event("mousedown");a.pageX=d3.event.pageX,a.clientX=d3.event.clientX,a.pageY=d3.event.pageY,a.clientY=d3.event.clientY,g.select(".main-brush").node().dispatchEvent(a)}).on("click",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],j.click(a)}).on("dblclick",j.regionfull),j.on("regionfull",function(){g.on("_regionchange")({xdomain:m.x})}),b.parentApp().config()>1&&p.xScale(h).dispatcher(j)(b);for(var c=0;c<n.length;c++)d(n[c]);b.parentApp().config()>2&&o.xScale(h).yScale(i).dispatcher(j)(b)}function c(){var a=b.spectra(!0);0===a.length&&(a=n);var c=d3.max(a.map(function(a){return a.range().x[0]})),d=d3.min(a.map(function(a){return a.range().x[1]})),e=d3.min(a.map(function(a){return a.range().y[0]})),f=d3.max(a.map(function(a){return a.range().y[1]})),i=f-e;e-=.05*i,f+=.05*i;var j=h.domain();g.on("_rangechange")({x:[c,d],y:[e,f],norender:n.length>1}),n.length>1&&g.on("_regionchange")({xdomain:j})}function d(a){g&&(a.xScale(h).yScale(i).dispatcher(j)(b),c())}var e=a("../elem"),f=e.SVGElem()["class"]("main-focus");e.inherit(b,f);var g,h,i,j,k,l,m={},n=e.ElemArray(),o=a("./peak-picker")(),p=a("./main-brush")(),q=0,r=d3.behavior.zoom().on("zoom",function(){if(!(d3.event.sourceEvent.timeStamp-q<50)){q=d3.event.sourceEvent.timeStamp;var a=m.y[1]/r.scale()-m.y[0],b=(a-(i.domain()[1]-i.domain()[0]))/2,c=[];i.domain()[0]===m.y[0]?c[0]=m.y[0]:c[0]=Math.max(i.domain()[0]-b,m.y[0]),c[1]=c[0]+a,g.on("_regionchange")({zoom:!0,ydomain:c})}});return b.changeRegion=function(a){g&&g.on("_regionchange")(a)},b.addSpec=function(e,f){if(!arguments.length)throw new Error("appendSlide: No data provided.");if(1!==e.nd||l&&e.x_label!==l)return void b.parentApp().appendSlide(e);"undefined"==typeof f&&(f=!0),console.log("x_labels",l,e.x_label);var g=null,h="spec"+n.length;"undefined"!=typeof e.s_id&&(g=e.s_id),"undefined"!=typeof e.label&&(h=e.label);var i=n.filter(function(a){return a.s_id()===g});return 0===i.length?(i=a("./line")().datum(e.data).crosshair(f).s_id(g).label(h),n.push(i),d(i)):(i=i[0],i.datum(e.data),c()),console.log("specs.length",n.length),1===n.length&&(l=e.x_label,console.log("set x_label to ",l,e.x_label)),b.parentApp()&&b.parentApp().dispatcher().slideContentChange(),i},b.addPeaks=function(a){g&&(g.select(".peaks").node().addpeaks(k.subset(a)),g.select(".peaks").on("_regionchange")({xdomain:!0}),g.select(".peaks").on("_redraw")({x:!0}))},b.nd=function(){return 1},b.spectra=function(a){return a?n.filter(function(a){return a.selected()}):n},b.highlightSpec=function(a){var b=n.indexOf(a);0>b?n.sel().classed("dimmed",!1).classed("highlighted",!1):(n.sel().classed("dimmed",!0),a.sel().classed("highlighted",!0))},b.peakPicker=function(){return o},b.mainBrush=function(){return p},b.range=function(){return m},b.datum=function(a){return arguments.length?(k=a,b.addSpec(a),b):k},b}},{"../elem":22,"./line":12,"./main-brush":13,"./peak-picker":15}],18:[function(a,b,c){b.exports=function(){function b(a,g){d=b.xScale()||a.xScale(),e=b.yScale()||a.yScale(),f=b.dispatcher()||a.dispatcher(),c=h(a).on("_mousemove",function(a){c.attr("d",d3.svg.line()([[d.range()[0],a.ycoor],[d.range()[1],a.ycoor]]))}).on("_click",function(a){g(e.invert(a.ycoor)),c.remove(),f.on("mousemove.thresh."+i,null),f.on("click.thresh."+i,null)});var i=++f.idx;f.on("mousemove.thresh."+i,c.on("_mousemove")),f.on("click.thresh."+i,c.on("_click"))}var c,d,e,f,g=a("../elem"),h=g.ResponsiveElem("path")["class"]("threshold line x");return g.inherit(b,h),b}},{"../elem":22}],19:[function(a,b,c){b.exports=function(){function b(){var a=".line."+j;i.on("regionchange"+a,null),i.on("mouseenter"+a,null),i.on("mouseleave"+a,null),i.on("mousemove"+a,null),k&&(i.on("regionchange"+a,f.on("_regionchange")),i.on("mouseenter"+a,function(){c.show(!0)}),i.on("mouseleave"+a,function(){c.show(!1)}),l&&i.on("mousemove"+a,f.on("_mousemove"))),i.on("crosshairEnable"+a,c.enable)}function c(a){g=c.xScale(),h=c.yScale(),i=c.dispatcher(),j=++i.idx,k=l=!0,f=e(a).classed("clr"+a.lineIdx(),!0).datum(null).call(m);var d=f.append("g").attr("class","crosshair line"),n=d.append("path").attr("class","crosshair line x"),o=d.append("path").attr("class","crosshair line y"),p=f.append("circle").attr("r",4.5);return f.on("_regionchange",function(){}).on("_mousemove",function(a){var b=[g.invert(a.xcoor),h.invert(a.ycoor)];f.datum(b),p.attr("transform","translate("+a.xcoor+","+a.ycoor+")"),m.text(d3.round(b[0],2)+", "+d3.round(b[1],2)).show(p.node()),n.attr("d",d3.svg.line()([[g.range()[0],a.ycoor],[g.range()[1],a.ycoor]])),o.attr("d",d3.svg.line()([[a.xcoor,h.range()[0]],[a.xcoor,h.range()[1]]]))}).on("remove",function(){c.enabled(!1),i.on("crosshairEnable.line."+j,null),m.destroy()}),b(),f}var d=a("../elem"),e=d.SVGElem()["class"]("crosshair");d.inherit(c,e);var f,g,h,i,j,k,l,m=d3.tip().attr("class","crosshair tooltip").direction("ne").offset([0,0]).bootstrap(!0);return c.show=function(a){return arguments.length?(l=a,f?(f.style("display",a?null:"none"),a?m.show(f):m.hide(),b(),c):c):l},c.enable=function(a){return arguments.length?(k=a,c.show(a)):k},c}},{"../elem":22}],20:[function(a,b,c){b.exports=function(){function b(a){g=b.xScale(),h=b.yScale(),i=b.dispatcher(),k=f(a).attr("pointer-events","all").attr("clip-path","url(#"+a.clipId()+")").attr("width",b.width()).attr("height",b.height()).call(o).on("dblclick.zoom",null).on("mousedown.zoom",null),k.on("_redraw",function(a){i.redraw(a)}).on("_regionchange",function(a){a.xdomain&&g.domain(a.xdomain),a.ydomain&&h.domain(a.ydomain),i.regionchange({xdomain:a.xdomain,ydomain:h.domain()}),k.on("_redraw")({x:a.xdomain,y:!0})}).on("_rangechange",function(a){a.x&&(l.x=a.x),a.y&&(l.y=a.y),i.rangechange(a),a.norender||k.on("_regionchange")({xdomain:l.x,ydomain:l.y})}),b.parentApp().config()>1&&(k.on("mouseenter",i.mouseenter).on("mouseleave",i.mouseleave).on("mousemove",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],i.mousemove(a)}).on("mousedown",function(){var a=new Event("mousedown");a.pageX=d3.event.pageX,a.clientX=d3.event.clientX,a.pageY=d3.event.pageY,a.clientY=d3.event.clientY,k.select(".main-brush").node().dispatchEvent(a)}).on("click",function(){var a=d3.event;a.xcoor=d3.mouse(this)[0],a.ycoor=d3.mouse(this)[1],i.click(a)}).on("dblclick",i.regionfull),i.on("regionfull",function(){k.on("_regionchange")({xdomain:l.x,ydomain:l.y})}));for(var d=0;d<m.length;d++)c(m[d]);b.parentApp().config()>1&&n.xScale(g).yScale(h).dispatcher(i)(b)}function c(a){k&&(a.xScale(g).yScale(h).dispatcher(i)(b),d())}function d(){var a=d3.max(m.map(function(a){return a.range().x[0]})),b=d3.min(m.map(function(a){return a.range().x[1]})),c=d3.min(m.map(function(a){return a.range().y[0]})),d=d3.max(m.map(function(a){return a.range().y[1]})),e=g.domain(),f=h.domain();k.on("_rangechange")({x:[a,b],y:[c,d],norender:m.length>1}),m.length>1&&k.on("_regionchange")({xdomain:e,ydomain:f})}var e=a("../elem"),f=e.SVGElem()["class"]("main-focus");e.inherit(b,f);var g,h,i,j,k,l={},m=e.ElemArray(),n=a("../d1/main-brush")(),o=d3.behavior.zoom().on("zoom",function(){var a=b.parent();a.select("#rfunc").attr("slope",o.scale()),a.select("#bfunc").attr("slope",o.scale())}).scaleExtent([.1,100]);return b.addSpec=function(d,e){if(!arguments.length)throw new Error("appendSlide: No data provided.");"undefined"==typeof e&&(e=!0);var f=m.filter(function(a){return a.s_id()===d.s_id});if(0===f.length){if(0!==m.length)return void b.parentApp().appendSlide(d);f=a("./spec2d")().datum(d.data).s_id(d.s_id).label(d.label).crosshair(e).range({x:d.x_domain,y:d.y_domain}),m.push(f),c(f)}else f=f[0],f.datum(d.data).range({x:d.x_domain,y:d.y_domain});return f},b.highlightSpec=function(){},b.changeRegion=function(a){k&&k.on("_regionchange")(a)},b.nd=function(){return 2},b.spectra=function(){return m},b.range=function(){return l},b.datum=function(a){return arguments.length?(j=a,b.addSpec(a),b):j},b}},{"../d1/main-brush":13,"../elem":22,"./spec2d":21}],21:[function(a,b,c){b.exports=function(){function b(a){k=b.xScale(),l=b.yScale(),m=b.dispatcher(),n=f(a),p=a.spectra().indexOf(b),o=n.append("g").attr("filter","url(#"+a.parent().filterId()+")").append("svg:image").attr("width",a.width()).attr("height",a.height()).attr("xlink:href","data:image/png;base64,"+g).attr("preserveAspectRatio","none"),j&&j.xScale(k).yScale(l).dispatcher(m)(b),n.on("_redraw",c).on("_regionchange",function(){}).on("_integrate",function(){}).on("_segment",function(){}).on("_remove",function(){m.on("regionchange.line."+d,null),m.on("redraw.line."+d,null),g=null,j&&j.remove()});var d=++m.idx;return m.on("regionchange.line."+d,n.on("_regionchange")),m.on("redraw.line."+d,n.on("_redraw")),n}function c(){if(o){var a=k.copy().domain(q.x),b=l.copy().domain(q.y),c=[-Math.min(a(k.domain()[1]),a(k.domain()[0])),-Math.min(b(l.domain()[1]),b(l.domain()[0]))],d=[Math.abs((q.x[0]-q.x[1])/(k.domain()[0]-k.domain()[1])),Math.abs((q.y[0]-q.y[1])/(l.domain()[0]-l.domain()[1]))];o.attr("transform","scale("+d+")translate("+c+")")}}function d(){o&&(o.attr("xlink:href","data:image/ png;base64,"+g),c())}var e=a("../elem"),f=e.SVGElem()["class"]("spec-img");e.inherit(b,f);var g,h,i,j,k,l,m,n,o,p,q={};return b.datum=function(a){return arguments.length?(g=a,d(),b):g},b.range=function(a){return arguments.length?(q=a,b):q},b.crosshair=function(c){return arguments.length?(j=c?a("./crosshair-2d")():!1,b):j},b.s_id=function(a){return arguments.length?(h=a,b):h},b.label=function(a){return arguments.length?(i=a,b):i},b.lineIdx=function(){return p},b}},{"../elem":22,"./crosshair-2d":19}],22:[function(a,b,c){function d(a,b){for(var c in b)"function"==typeof b[c]&&d3.rebind(a,b,c)}function e(a){return a||(a=[]),a.nodes=function(){return this.map(function(a){return a.node()})},a.sel=function(){return d3.selectAll(this.nodes())},a}function f(a){function b(b){return c=b.append(a||"div"),d=b,g&&c.classed(g,!0),c}var c,d,e,f,g;return b.sel=function(){return c},b.node=function(){return c?c.node():void 0},b.parent=function(){return d},b.width=function(a){return arguments.length?(e=a,b):e},b.height=function(a){return arguments.length?(f=a,b):f},b["class"]=function(a){return arguments.length?(g=a,b):g},b.append=function(a){if(!c)throw new Error("Elem is not in DOM");return c.append(a)},b.select=function(a){if(!c)throw new Error("Elem is not in DOM");return c.select(a)},b.selectAll=function(a){if(!c)throw new Error("Elem is not in DOM");return c.selectAll(a)},b.remove=function(){c&&(c.on("remove")&&c.on("remove")(),c.remove())},b.parentApp=function(){for(var a=d;a;){if("function"==typeof a.currentSlide)return a;a=a.parent?a.parent():null}return null},b}function g(a){function b(a){var b=i(a);return b}var c,e,g,h,i=f(a);return b.xScale=function(a){return arguments.length?(c=a,b):c},b.yScale=function(a){return arguments.length?(e=a,b):e},b.datum=function(a){return arguments.length?(g=a,b):g},b.dispatcher=function(a){return arguments.length?(h=a,b):h},d(b,i),b}function h(){function a(a){var c=b(a);return c}var b=g("g");return d(a,b),a}b.exports.inherit=d,b.exports.ElemArray=e,b.exports.Elem=f,b.exports.ResponsiveElem=g,b.exports.SVGElem=h},{}],23:[function(a,b,c){function d(a,b,c){a=a.toUpperCase();var d=a.split(" "),e=d[d.length-1],f=a.indexOf("SHIFT")>-1,h=a.indexOf("CONTROL")>-1||a.indexOf("CTRL")>-1,i=a.indexOf("ALT")>-1;g.push({key:[e,f,h,i],fun:b,message:c})}function e(a){return ret="",a[1]&&(ret+="⇧"),a[2]&&(ret+="Ctrl"),a[3]&&(ret+="⌥"),a[0]&&(ret+=a[0]),console.log(a,ret),ret}var f={crosshair:!0,peakpick:!1,peakdel:!1,integrate:!1,zoom:["x","y",!1]},g=[];f.crosshairToggle=function(a){f.crosshair=!f.crosshair,a.slideDispatcher().crosshairEnable(f.crosshair)},f.peakpickToggle=function(a){f.zoom[0]!==!1&&f.zoom.rotateTo(!1),f.peakdel!==!1&&f.peakdelToggle(a),f.integrate!==!1&&f.integrateToggle(a),f.peakpick=!f.peakpick,a.slideDispatcher().peakpickEnable(f.peakpick)},f.peakdelToggle=function(a){f.zoom[0]!==!1&&f.zoom.rotateTo(!1),f.peakpick!==!1&&f.peakpickToggle(a),f.integrate!==!1&&f.integrateToggle(a),f.peakdel=!f.peakdel,a.slideDispatcher().peakdelEnable(f.peakdel)},f.integrateToggle=function(a){f.zoom[0]!==!1&&f.zoom.rotateTo(!1),f.peakpick!==!1&&f.peakpickToggle(a),f.peakdel!==!1&&f.peakdelToggle(a),f.integrate=!f.integrate,a.slideDispatcher().integrateEnable(f.integrate)},f.zoomToggle=function(a){f.peakpick!==!1&&f.peakpickToggle(a),f.peakdel!==!1&&f.peakdelToggle(a),f.integrate!==!1&&f.integrateToggle(a),f.zoom.rotate()},f.display_shortcuts=function(a){var b=a.modals().proto("Keyboard Shortcuts","","hide");el=d3.select(b.modal.el).select(".nanoModalContent"),el.append("table").selectAll("tr").data(g).enter().append("tr").each(function(a,b){var c=d3.select(this);c.append("td").append("kbd").text(e(a.key)),c.append("td").text(a.message)}),b.show()},f.registerKeyboard=function(a){d("?",f.display_shortcuts,"Display help and keyboard shortcuts"),d("c",f.crosshairToggle,"Toggle crosshair"),d("z",f.zoomToggle,"Toggle zoom"),d("f",function(a){a.slideDispatcher().regionfull(a)},"View full spectrum"),d("shift",null,"Move cursor to nearest peak maximum"),a.config()>2&&(d("p",f.peakpickToggle,"Peak picking"),d("d",f.peakdelToggle,"Peak deletion"),d("i",f.integrateToggle,"Peak integration")),d3.select("body").on("keypress",function(){for(var b=String.fromCharCode(d3.event.keyCode).toUpperCase(),c=0;c<g.length;c++){var d=g[c].key;if(!(d[0]!=b||d[1]&&!d3.event.shiftKey||d[2]&&!d3.event.ctrlKey||d[3]&&!d3.event.altKey)){g[c].fun(a);break}}a.slideDispatcher().keyboard(d3.event)})},b.exports=f},{}],24:[function(a,b,c){a("./utils/array"),b.exports={},b.exports.App=a("./main_app"),b.exports.hooks={},b.exports.hooks.readers=a("./pro/plugin-hooks"),b.exports.hooks.input=a("./input_elem"),b.exports.get_spectrum=a("./pro/process_data").get_spectrum,b.exports.version="0.6.0"},{"./input_elem":25,"./main_app":27,"./pro/plugin-hooks":39,"./pro/process_data":41,"./utils/array":44}],25:[function(a,b,c){var d={},e=a("./utils/event");d.num=function(a,b,c,d,e,f){var g=d3.select(document.createElement("label"));return g.classed("param num",!0).text(a).append("input").attr({type:"number",value:"undefined"==typeof b?0:b,min:"undefined"==typeof c?-(1/0):c,max:"undefined"==typeof d?1/0:d,step:"undefined"==typeof e?1:e}).text("undefined"==typeof f?"":f),g.node().getValue=function(){return g.select("input").node().value},function(){return g.node()}},d.text=function(a,b){var c=d3.select(document.createElement("label"));return c.classed("param text",!0).text(a).append("input").attr({type:"text",placeholder:b||""}),function(){return c.node()}},d.checkbox=function(a,b){var c=d3.select(document.createElement("label"));return c.classed("param checkbox",!0).append("input").attr("type","checkbox").on("change",function(){e(this,"input")}).node().checked=b?!0:!1,c.append("div").classed("checker",!0),c.append("div").classed("checkbox-label",!0).text("string"==typeof a?a:""),c.node().getValue=function(){return c.select("input").node().checked},function(){return c.node()}},d.checkbox_toggle=function(a,b,c){var f=d3.select(document.createElement("div")).classed("param checkbox-toggle",!0);return f.append(d.checkbox(a,b)).select("input").on("change",function(){f.select(".div_enable").classed("disabled",!this.checked),e(this,"input")}),f.append(d.div(c)).classed("div_enable",!0).classed("disabled",!f.select("input").node().checked),f.node().getValue=f.select(".param.checkbox").node().getValue,function(){return f.node()}},d.select=function(a,b,c){var d=d3.select(document.createElement("label")).classed("param select",!0).text(a),e=d.append("select");return e.selectAll("option").data(b).enter().append("option").text(function(a){return a}),e.node().value=c,d.node().getValue=function(){return e.node().value},function(){return d.node()}},d.select_multi=function(a,b){var c=d3.select(document.createElement("div")).classed("param select-multi",!0);return c.append("label").text(a).append("input").attr("type","checkbox").style("display","none").on("change",function(){c.select("ul").classed("shown",this.checked)}).node().checked=!1,c.append("ul").classed("block-list",!0).selectAll("li").data(b).enter().append("li").each(function(a){d3.select(this).append(d.checkbox(a,!0))}),c.node().getValue=function(){return c.selectAll(".param.checkbox").filter(function(){return this.children[0].checked})[0].map(function(a){
return"undefined"!=typeof a.value?a.value:d3.select(a).select(".checkbox-label").text()})},function(){return c.node()}},d.select_toggle=function(a,b,c){console.log(a,b);var f=d3.select(document.createElement("div")).classed("param select-toggle",!0);f.append(d.select(a,Object.keys(b))).selectAll("option").attr("value",function(a){return a}).text(function(a){return b[a][0]});var g=f.append("div").classed("method_params",!0),h=f.select("select").node();return f.select("select").on("input",function(){d3.event.stopPropagation()}).on("change",function(){g.select("fieldset").remove(),Object.keys(b[h.value][1]).length>0&&g.append("fieldset").append(d.div(b[h.value][1],c)),console.log(c),e(this.parentNode,"input")}),Object.keys(b[h.value][1]).length>0&&g.append("fieldset").append(d.div(b[h.value][1],c)),f.node().getValue=function(){return h.value},function(){return f.node()}},d.button=function(a){var b=d3.select(document.createElement("input")).classed("param btn",!0).attr("type","button").attr("value",a).on("click",function(){e(this,"input")});return b.node().getValue=function(){return d3.event&&d3.event.target===b.node()},function(){return b.node()}},d.threshold=function(b,c,e){var f=d3.select(document.createElement("div")).classed("param threshold",!0),g=f.append("input").attr("type","hidden"),h=f.append("input").attr("type","text").attr("readonly","readonly");return f.insert(d.button(b),":last-child").on("click",function(){var b=d3.selectAll(".nanoModalOverride:not([style*='display: none'])").style("display","none"),c=a("./d1/threshold")();c(e.currentSlide().specContainer(),function(a){h.attr("value",a.toExponential(2)),g.attr("value",a),b.style("display","block")})}),f.node().getValue=function(){return g.node().value},function(){return f.node()}},d.div=function(a,b){var c=d3.select(document.createElement("div"));for(var d in a){var e=a[d];"function"!=typeof e&&(c.append(f.apply(null,e.concat(b))).node().id=d)}return function(){return c.node()}};var f=function(a,b,c,e){var f=[d.num,d.checkbox,d.text,d.select_toggle,d.checkbox_toggle,d.button,d.threshold][b],g=[a].concat(c);return g=-1!==[3,4,6].indexOf(b)?g.concat(e):g,f.apply(null,g)};d.spectrumSelector=function(a){var b=a.currentSlide()?a.currentSlide().spectra():null;if(!b||0===b.length)return function(){return d3.select(document.createElement("div")).text("No Spectra to show").node()};var c=a.currentSlide().specContainer(),e=d3.select(d.select_multi("Select Spectrum",b)()).classed("spec-selector",!0);return e.selectAll("li").each(function(a){d3.select(this).select(".checkbox").style("color",getComputedStyle(a.select("path").node()).stroke).style("opacity",getComputedStyle(a.select("path").node()).strokeOpacity).select(".checkbox-label").text(a.label()),d3.select(this).on("mouseenter",function(){c.highlightSpec(a)}).on("mouseleave",function(){c.highlightSpec()})}),e.node().getValue=function(){return e.selectAll("li").filter(function(){return d3.select(this).select("input").node().checked===!0}).data().map(function(a){return a.s_id()})},e.node().id="sid",function(){return e.node()}},d.preview=function(a){var b={prev_auto:["Instant Preview",1,"undefined"!=typeof a],prev_btn:["Preview",5,null]};return d.div(b)},d.popover=function(a){var b=d3.select(document.createElement("div")).classed("popover right",!0);b.append("div").classed("arrow",!0);var c=b.append("div").classed("popover-inner",!0);return c.append("h3").classed("popover-title",!0).text(a),c.append("div").classed("popover-content",!0),function(){return b.node()}},b.exports=d},{"./d1/threshold":18,"./utils/event":46}],26:[function(a,b,c){b.exports=function(a){a.append("div").classed("logo",!0).text("SpecdrawJS").on("click",function(){a.modals().proto("SpecdrawJS",'A javascript library for interactive processing and visualization of NMR spectra.<br> Author: Ahmed Mohamed<br> For bug reports, go to <a href="https://github.com/ahmohamed/specdraw.js/issues" target="_blank"> Github Repository </a>',function(a){a.hide()}).show()})}},{}],27:[function(a,b,c){b.exports=function(){function b(b){if(i=c.width(),j=c.height(),"undefined"==typeof i||"undefined"==typeof j||isNaN(i)||isNaN(j)){var d=a("./utils/get-size")(b);if(i=d[0],j=d[1],"undefined"==typeof i||"undefined"==typeof j)return!1}return 300>i||300>j?!1:!0}function c(c){return b(c.node())?void d(c):void a("./utils/docready")(function(){d(c)})}function d(d){if(!b(d.node())){if("specdraw-js"!==d.node().tagName.toLowerCase())throw new Error("SpecApp: Canvas size too small. Width and height must be at least 400px");if(!b(d.node().parentNode))throw new Error("SpecApp: Canvas size too small. Width and height must be at least 400px")}h=g(d).style({width:i,height:j}),k=a("./modals")(c),n>1&&(a("./menu/menu")(c),i-=50,a("./events").registerKeyboard(c)),m.on("slideChange.app",function(a){l!==a&&c.currentSlide(a)});for(var f=0;f<o.length;f++)e(o[f]);0===o.length&&c.appendSlide(),a("./logo")(c)}function e(a){h&&(a.width(i).height(j)(c),c.currentSlide(a))}var f=a("./elem"),g=f.Elem()["class"]("spec-app");f.inherit(c,g);var h,i,j,k,l,m=d3.dispatch("slideChange","slideContentChange","menuUpdate"),n=3,o=f.ElemArray(),p="/nmr/";return c.slides=function(){return o},c.currentSlide=function(a){return arguments.length?(l&&l.show(!1),a.show(!0),l=a,void m.slideChange(a)):l||o[o.length-1]},c.dispatcher=function(){return m},c.slideDispatcher=function(){return l.slideDispatcher()},c.modals=function(){return k},c.pluginRequest=a("./pro/plugins")(c),c.appendSlide=function(b){console.log("append_slide start");var d=a("./slide")().datum(b);return console.log("slide added"),o.push(d),e(d),c},c.config=function(a){return arguments.length?(n=a,c):n},c.connect=function(a){return arguments.length?(p=a,n=4,c):p},c.options={grid:{x:!1,y:!1}},c.data=function(b,d){"undefined"==typeof d&&(d=5);var e=function(a){!c.currentSlide()||c.currentSlide().spectra().length>d-1?c.appendSlide(a):c.currentSlide().addSpec(a,n>1)};return a("./pro/process_data").get_spectrum(b,e),c},c}},{"./elem":22,"./events":23,"./logo":26,"./menu/menu":30,"./modals":35,"./pro/plugins":40,"./pro/process_data":41,"./slide":43,"./utils/docready":45,"./utils/get-size":48}],28:[function(a,b,c){function d(a,b){for(var c=a.length-1;c>=0;c--)if(a[c].label===b)return a[c].children||(a[c].children=[]),a[c];return a.push({label:b,children:[]}),a[a.length-1]}b.exports=function(a,b){for(var c=d(a,b[0]),e=1;e<b.length;e++)c=d(c.children,b[e]);return c}},{}],29:[function(a,b,c){function d(a){return a.enter().append("li").text(function(a){return a.label}).classed("menu-item",!0).classed("not1d",function(a){return a.nd&&a.nd.indexOf(1)<0}).classed("not2d",function(a){return a.nd&&a.nd.indexOf(2)<0}),a}function e(a){var b=a.filter(function(a){return a.children}).classed("openable",!0).append("div").append("ul").selectAll("li").data(function(a){return a.children}).call(d);b.filter(function(a){return a.children}).size()>0&&e(b)}function f(a){function b(b){b.select(".menu-container").remove();var f=b.append(g.popover("Menu")).classed("menu-container",!0).select(".popover-content").append("div").classed("main-menu",!0).append("ul").classed("nav",!0);f.selectAll("li").data(c).call(d).call(e),f.selectAll("li").on("click",function(c){c.fun?(h(b.node(),"click"),c.fun(a)):this.focus()})}var c;return b.data=function(a){return arguments.length?(c=a,b):c},b}var g=a("../input_elem"),h=a("../utils/event");b.exports=f},{"../input_elem":25,"../utils/event":46}],30:[function(a,b,c){var d=a("../utils/fullscreen"),e=a("../../lib/bootstrap-tooltip").bootstrap,f=a("../events");b.exports=function(b){function c(a){if(d3.event.target===this){var b=d3.select(this).toggleClass("opened"),c=b.classed("opened");return b.select(".tooltip").style("display",c?"none":null),c&&"function"==typeof a&&b.call(a),c}}var g=a("./main_menu")(b),h=a("./spectra")(b),i=a("./slides")(b),j=a("./menu_data"),k=[["open-menu","Menu"],["open-spec-legend","Spectra"],["open-slides","Slides"],["kbd","Keyboard Shortcuts"]];b.config()>2&&(k=k.concat([["open-fullscreen","Fullscreen App"],["connection-status","Connection Status"]]));var l=b.append("div").classed("column-menu",!0);l.selectAll("div").data(k).enter().append("div").attr("class",function(a){return a[0]}).attr("title",function(a){return a[1]}).call(e.tooltip().placement("right")).on("click",c),l.select(".open-spec-legend").on("click",function(){c.apply(this,[h])}),l.select(".open-slides").on("click",function(){c.apply(this,[i])}),l.select(".kbd").on("click",function(){f.display_shortcuts(b)});var m=b.dispatcher();return m.on("slideChange.menu",function(){l.select(".open-spec-legend").call(h),l.select(".open-slides").call(i),m.menuUpdate()}),m.on("slideContentChange.menu",function(){l.select(".open-spec-legend").call(h)}),m.on("menuUpdate.menu",function(){l.select(".open-menu").call(g.data(j(b)))}),l.select(".open-menu").call(g.data(j(b))),b.config()<3?l:(l.select(".open-fullscreen").on("click",function(){d.toggle(b.node()),c.apply(this)}),d3.select(window).on("resize.fullscreenbutton",function(){l.select(".open-fullscreen").classed("opened",d.isFull())}),l)}},{"../../lib/bootstrap-tooltip":1,"../events":23,"../utils/fullscreen":47,"./main_menu":29,"./menu_data":31,"./slides":33,"./spectra":34}],31:[function(a,b,c){function d(b,c){b.selectAll("text").attr("font-size","10px"),a("save-svg-as-png").svgAsDataUri(b.node().parentNode,{},function(a){var b=document.createElement("a");b.download=c,b.href=a,b.setAttribute("data-downloadurl",a),b.click()})}function e(b,c){b.selectAll("text").attr("font-size","10px"),a("save-svg-as-png").saveSvgAsPng(b.node().parentNode,c)}function f(a,b){var c=h(b,a.menu_path);c.children=null,c.fun=a.fun,c.nd=a.nd}var g=a("../events"),h=a("./append-menu"),i=a("./serverside-menu"),j=[{menu_path:["View","Change region","Set X region"],fun:function(a){a.modals().xRegion()},nd:[1,2]},{menu_path:["View","Change region","Set Y region"],fun:function(a){a.modals().yRegion()},nd:[1,2]},{menu_path:["View","Change region","Full spectrum"],fun:function(a){a.slideDispatcher().regionfull()},nd:[1,2]},{menu_path:["View","Show/hide crosshair"],fun:g.crosshairToggle,nd:[1,2]}],k=[{menu_path:["Analysis","Peak Picking","Manual peak picking"],fun:g.peakpickToggle,nd:[1]},{menu_path:["Analysis","Peak Picking","Delete peaks"],fun:g.peakdelToggle,nd:[1]},{menu_path:["Analysis","Peak integration"],fun:g.integrateToggle,nd:[1]},{menu_path:["Save Slide","As PNG image"],fun:function(a){e(a.currentSlide(),"specdraw_slide.png")},nd:[1,2]},{menu_path:["Save Slide","As SVG image"],fun:function(a){d(a.currentSlide(),"specdraw_slide.svg")},nd:[1,2]},{menu_path:["Bin Spectra"],fun:function(b){b.modals().input("Bin size",.04,function(c){for(var d=a("../d1/binning"),e=b.currentSlide().spectra(!0),f=0;f<e.length;f++)d(e[f],+c)})()},nd:[1]}];b.exports=function(a){var b=j;if(a.config()>2&&(b=b.concat(k)),a.config()>3&&(b=i(a).concat(b)),a.currentSlide()&&a.currentSlide().nd()){var c=a.currentSlide().nd();b=b.filter(function(a){return!(a.nd&&a.nd.indexOf(c)<0)})}for(var d=[],e=0;e<b.length;e++)f(b[e],d);return d}},{"../d1/binning":9,"../events":23,"./append-menu":28,"./serverside-menu":32,"save-svg-as-png":7}],32:[function(a,b,c){function d(a,b){function c(a){return a.args?function(b){b.modals().methods(a.fun,a.args,a.title)()}:function(b){b.pluginRequest(a.fun)}}for(var d=0;d<b.length;d++)e.push({menu_path:b[d].menu_path,nd:b[d].nd,fun:c(b[d])});a.dispatcher().menuUpdate()}var e,f=a("../../lib/bootstrap-tooltip").bootstrap,g=a("../pro/ajax");b.exports=function(a){function c(b){a.select(".connection-status").attr("class","connection-status connected").attr("title","Connection status: connected").call(f.tooltip().placement("right")),d(a,b)}function h(){e=void 0,a.select(".connection-status").attr("class","connection-status disconnected").attr("title","Disconnected. Click to reconnect.").on("click",function(){b.exports(a)}).call(f.tooltip().placement("right"))}return e?e:(e=[],a.select(".connection-status").attr("class","connection-status connecting").attr("title","Connection status: connecting").on("click",null).call(f.tooltip().placement("right")),g.getJSON(a.connect()+"menu",c,h),[])}},{"../../lib/bootstrap-tooltip":1,"../pro/ajax":36}],33:[function(a,b,c){var d=a("../input_elem");b.exports=function(a){function b(b){b.select(".menu-container").remove();var c=b.append(d.popover("Slides")).classed("menu-container",!0).select(".popover-content");return c.append("ul").classed("block-list slide-list",!0).selectAll("li").data(a.slides).enter().append("li").text(function(a,b){return"Slide "+(b+1)}).on("click",function(b){a.dispatcher().slideChange(b)}),a.config()>2&&c.select("ul").append("li").text("+ New Slide").on("click",function(){a.appendSlide()}),b}return b}},{"../input_elem":25}],34:[function(a,b,c){function d(b){function c(c){c.select(".menu-container").remove();var d=c.append(e.popover("Spectra")).classed("menu-container",!0).select(".popover-content"),f=e.spectrumSelector(b);if(b.currentSlide()&&0!==b.currentSlide().spectra().length){var g=d3.select(f()).select("ul");b.config()>2&&g.append("li").text("+ Add spectrum").on("click",a("../pro/open-file")(b)),d.append(function(){return g.node()}).classed("block-list spec-list no-checkbox",!0)}else d.append(f);return c}return c}var e=a("../input_elem");b.exports=d},{"../input_elem":25,"../pro/open-file":38}],35:[function(a,b,c){function d(b){var c={};return c.proto=function(a,c,d,f){var g=e("",{overlayClose:!1,autoRemove:!0,buttons:[{text:"OK",handler:d,primary:!0},{text:"Cancel",handler:f||"hide",classes:"cancelBtn"}]});b||(b=d3.select(".spec-app")),b.append(function(){return g.overlay.el}),b.append(function(){return g.modal.el});var h=d3.select(g.modal.el);return h.select(".nanoModalContent").html(c||""),h.insert("div",":first-child").classed("title",!0).text(a?a:"Dialogue"),h.on("keydown",function(){13===d3.event.keyCode&&d3.select(g.modal.el).select(".nanoModalBtnPrimary").node().click(),27===d3.event.keyCode&&d3.select(g.modal.el).select(".cancelBtn").node().click()}),g.onShow(function(){h.style({display:"flex","flex-direction":"column","margin-left":-h.node().clientWidth/2,"max-width":.8*h.node().parentNode.clientWidth,"max-height":.8*h.node().parentNode.clientHeight});var a=d3.behavior.drag().on("drag",function(){h.style("top",d3.event.sourceEvent.pageY+"px").style("left",d3.event.sourceEvent.pageX+"px")});d3.select(g.modal.el).select(".title").call(a),d3.select(g.modal.el).select(".cancelBtn").node().focus()}),g},c.error=function(a,b){var d=c.proto("Error: "+a,b);d3.select(d.modal.el).classed("errorModal",!0).select(".cancelBtn").text("Dismiss"),d.show()},c.range=function(a,b,d,f){var g;g=b[0]>b[1]?[b[1],b[0]]:b,g=[d3.round(g[0],3),d3.round(g[1],3)],"undefined"==typeof f?f=g:(f[0]>f[1]&&(f=[f[1],f[0]]),f=[d3.round(f[0],3),d3.round(f[1],3)]);var h=a+'<input type="number" id="range0" step="0.001" value='+f[0]+" min="+g[0]+" max="+g[1]+'> - <input type="number" id="range1" step="0.001" value='+f[1]+" min="+g[0]+" max="+g[1]+">",i=c.proto("Range",h,function(a){a.hide();var c=d3.select(a.modal.el).selectAll("input")[0].map(function(a){return+a.value});c[0]<g[0]||c[0]>g[1]||c[1]<g[0]||c[1]>g[1]||c[0]>c[1]?e("Invalid input."+c).show():d(b[0]>b[1]?c.reverse():c)});return i.show},c.input=function(a,b,d){var e=a+'<input type="number" id="input0" step="0.001" value='+b+">",f=c.proto("Numeric",e,function(a){a.hide();var b=d3.select(a.modal.el).select("input").node().value;d(b)});return f.show},c.xRegion=function(){c.range("Set x region to:<br>",b.currentSlide().range().x,function(a){b.currentSlide().changeRegion({xdomain:a})},b.currentSlide().specContainer().xScale().domain())()},c.yRegion=function(){c.range("Set y region to:\n",b.currentSlide().range().y,function(a){b.currentSlide().changeRegion({ydomain:a})},b.currentSlide().specContainer().yScale().domain())()},c.slider=function(a,b,d){var e=a+'<input id="slider" type="range" min="-5" max="5" value="0" step="0.001"/>',f=c.proto("Slider",e,function(a){a.hide()},function(){d(0)});return d3.select(f.modal.el).select("#slider").on("input",function(){d(+this.value)}),f.show},c.scaleLine=function(){c.slider("Scale spectrum by a factor:",0,function(a){b.currentSlide().spectra(!0).forEach(function(b){b.setScaleFactor(Math.pow(2,a))})})()},c.methods=function(d,e,f,g,h){var i,j=!0,k=function(b){j=!1,a("./utils/event")(i.node(),"input"),b.hide()},l=c.proto(f,"",k);i=d3.select(l.modal.el).select(".nanoModalContent");var m=null;i.on("input",function(){var a={};i.selectAll(".param").filter(function(){return""!==this.id}).each(function(){a[this.id]=this.getValue()}),m&&clearTimeout(m),j===!1||d3.event.target===i||a.prev_btn===!0?b.pluginRequest(d,a,a.s_id,j):a.prev_auto===!0&&(m=setTimeout(function(){b.pluginRequest(d,a,a.s_id,!0)},300))});var n=a("./input_elem");return i.append(n.spectrumSelector(b)),i.append(n.div(e,b)),l.show},c}a("nanoModal");var e=window.nanoModal;e.customHide=function(a,b){b.modal.el.style.display="block",a()},b.exports=d},{"./input_elem":25,"./utils/event":46,nanoModal:6}],36:[function(a,b,c){var d=a("../modals")(),e=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=function(){var a=4,e=200;d.readyState===a&&d.status===e?"function"==typeof b&&b(d.responseText):d.readyState===a&&c(d.responseText)},d.send()},f=function(a,b,c,f){var h=g();"function"!=typeof c&&(c=d.error),e(a,function(a){h.stop();var d;try{d=JSON.parse(a)}catch(e){d=a.toString()}"undefined"==typeof d.error?b(d):c(d.error.name,d.error.message)},function(a){h.stop(),c("Network Error",a)}),f&&h()},g=function(){function a(){e("/nmr/test",function(b){c?e("/nmr/test?complete=1"):(d3.select(".progress").text(b),setTimeout(a,100))})}var b,c=!1,d=function(){a()};return d.stop=function(){clearInterval(b),c=!0,d3.select(".progress").text("Completed")},d};b.exports.request=e,b.exports.getJSON=f},{"../modals":35}],37:[function(a,b,c){function d(a){for(var b=a.data[0],c=[],d=0;d<b.length;d+=2)c.push({x:b[d],y:b[d+1]});return c}function e(a){var b={};return b.data=d(a.spectra[0]),b}function f(a){var b={},c=a.spectra,d=d3.max([Math.abs(a.minMax.minZ),Math.abs(a.minMax.maxZ)]);d=[-d,d];for(var e,f=c.length,g=c[0].nbPoints,h=d3.scale.linear().domain(d).rangeRound([0,255]).clamp(!0),i=d3.select(document.createElement("canvas")).attr("width",f).attr("height",g).style("width",f+"px").style("height",g+"px").node(),j=i.getContext("2d"),k=j.createImageData(f,g),l=0,m=2*g-1;m>0;m-=2)for(var n=0;f>n;n++)e=h(c[n].data[0][m]),k.data[l++]=e,k.data[l++]=e,k.data[l++]=e,k.data[l++]=255;return j.putImageData(k,0,0,0,0,f,g),b.data=i.toDataURL("image/png").replace("data:image/png;base64,",""),b.x_domain=[a.minMax.minX,a.minMax.maxX],b.y_domain=[a.minMax.minY,a.minMax.maxY],b.z_domain=d,b.nd=2,b.data_type="spectrum",b.format="png",b}var g=a("jcampconverter");b.exports=function(a,b){var c,d=g.convert(a,{keepSpectra:!0});c=d.twoD?f(d):e(d),c.label=d.spectra[0].title,c.x_label=d.xType,c.y_label=d.yType,c.nd=d.twoD?2:1,b(c)}},{jcampconverter:5}],38:[function(a,b,c){function d(a,b,c){var d=a.modals(),e=d.proto(void 0,"",function(a){a.hide();var b=d3.select(a.modal.el).select("input").node().value;c(b)}),f=d3.select(e.modal.el).select(".nanoModalContent");return f.append(b),e.show}b.exports=function(b,c){return function(){c=c||b.currentSlide().addSpec,d(b,a("../input_elem").text("File URL","http://"),function(b){a("./process_data").get_spectrum(b,c)})()}}},{"../input_elem":25,"./process_data":41}],39:[function(a,b,c){function d(a,b){var c=a.currentSlide().spectra().filter(function(a){return a.s_id()===b.s_id});0===c.length&&a.modals.error("Incompatible server response","Can't find spectrum with s_id:"+b.s_id),c[0].addPeaks(b.peaks),a.slideDispatcher().peakpick()}function e(a,b){var c=a.currentSlide().spectra().filter(function(a){return a.s_id()===b.s_id});0===c.length&&a.modals.error("Incompatible server response","Can't find spectrum with s_id:"+b.s_id);for(var d=0;d<b.segs.length;d++)c[0].addSegmentl(b.segs[d])}function f(a,b,c){void 0!==b.peaks&&d(a,b,c),void 0!==b.segs&&e(a,b,c)}function g(b,c,d){a("./process_data").process_spectrum(c,b.currentSlide().addSpec)}b.exports.spectrum=g,b.exports.spec_feature=f},{"./process_data":41}],40:[function(a,b,c){b.exports=function(b){function c(c,e,f,g){e=e||{};var h,i;if(e.sid||(f?e.sid=f:(h=b.currentSlide().spectra(!0),i=h.map(function(a){return a.s_id()}),e.sid=i.filter(function(a){return a}))),0===e.sid.length){var j="Please select one or more spectra!";if(i.length>0){h=b.currentSlide().spectra();var k=h.filter(function(a){return!a.s_id()}).map(function(a){return a.label()}).join(", ");j+="<br>NOTE: ["+k+"] spectra are stored locally and not connected to the server."}return void b.modals().error("No Spectra selected",j)}var l=c+"_",m="sid="+JSON.stringify(e.sid)+"&preview="+ +g+"&"+l+"=null";for(var n in e)"sid"!==n&&(m.length>0&&(m+="&"),m+=l+n+"="+e[n]);var o=b.connect()+"plugins?"+m,p=a("./ajax");p.getJSON(o,function(a){d(a,g)})}function d(c,e){if(c.constructor!==Array){var f=a("./plugin-hooks"),g=c.data_type;void 0===g&&(g="spectrum"),"function"==typeof f[g]?f[g](b,c,e):b.modals.error("Unsupported data-type","Couldn't find suitable function to read \""+g+'" data')}else for(var h=c.length-1;h>=0;h--)d(c[h])}return c}},{"./ajax":36,"./plugin-hooks":39}],41:[function(a,b,c){function d(b,c){if("object"!=typeof b)return console.log(b,typeof b),a("./jcamp")(b,c);if(b.constructor!==Array)switch(b.format){case"xy":f(b,c);break;case"base64":g(b,c);break;case"png":case"png16":a("./worker").maxWorkers()>0?i(b,c):h(b,c)}else for(var e=b.length-1;e>=0;e--)d(b[e],c)}function e(b,c){var e=a("./ajax");e.getJSON(b,function(a){d(a,c)})}var f=function(a,b){var c=a.x.map(function(b,c){return{x:b,y:a.y[c]}});b(c)},g=function(a,b){var c=atob(a.y);console.log(c);var d=d3.scale.linear().range(a.x_domain).domain([0,c.length]),e=d3.scale.linear().range(a.y_domain).domain([0,255]),f=c.map(function(a,b){return{x:d(b),y:e(a)}});b(f)},h=function(a,b){if(a.nd&&1!==a.nd)2===a.nd?b(a):console.log("Unsupported data dimension: "+a.nd);else{var c=document.createElement("img");c.onload=function(){var d=document.createElement("canvas");d.width=c.width,d.height=c.height;var e=d.getContext("2d");e.drawImage(c,0,0);var f=e.getImageData(0,0,c.width,c.height).data,g=[],h="png16"===a.format,i=h?f.length/2:f.length,j=d3.scale.linear().range(a.y_domain).domain([0,255]);h&&j.domain([0,Math.pow(2,16)-1]);for(var k=0;i>k;k+=4)h?g.push(j((f[k+i]<<8)+f[k])):g.push(j(f[k]));if(a.x_domain){var l=d3.scale.linear().range(a.x_domain).domain([0,g.length]);g=g.map(function(a,b){return{x:l(b),y:a}})}var m;m="undefined"!=typeof a.s_id?{data:g,s_id:a.s_id}:{data:g},b(m)};var d=a.data?a.data:a.y;c.src="data:image/png;base64,"+d}},i=function(b,c){if(b.nd&&1!==b.nd)2===b.nd?c(b):console.log("Unsupported data dimension: "+b.nd);else{var d=document.createElement("img");d.onload=function(){var e=document.createElement("canvas");e.width=d.width,e.height=d.height;var f={};f._16bit="png16"===b.format;var g=e.getContext("2d");g.drawImage(d,0,0),f.buffer=g.getImageData(0,0,d.width,d.height).data,f.y_range=b.y_domain,f.y_domain=[0,255],f._16bit&&(f.y_domain=[0,Math.pow(2,16)-1]);var h=function(a){console.log("worker done");var d=[].slice.call(a.data);if(b.x_domain){var e=d3.scale.linear().range(b.x_domain).domain([0,d.length]);d=d.map(function(a,b){return{x:e(b),y:a}})}b.data=d,c(b)},i=[f,[f.buffer.buffer]];a("./worker").addJob({message:i,callback:h})};var e=b.data?b.data:b.y;d.src="data:image/png;base64,"+e}};b.exports.get_spectrum=e,b.exports.process_spectrum=d},{"./ajax":36,"./jcamp":37,"./worker":42}],42:[function(a,b,c){function d(){var a=function(){function a(a,b){var c=b[1]-b[0],d=a[1]-a[0];return function(e){return(e-b[0])/c*d+a[0]}}self.onmessage=function(b,c){b=b.data;for(var d=b.buffer,e=b._16bit?d.length/2:d.length,f=a(b.y_range,b.y_domain),g=new Float64Array(e/4),h=0;e>h;h+=4)b._16bit?g[h/4]=f((d[h+e]<<8)+d[h]):g[h/4]=f(d[h]);self.postMessage(g,[g.buffer])}},b=new Blob(["("+a.toString()+")()"],{type:"application/javascript"}),c=window.URL.createObjectURL(b),d=new Worker(c);return d}function e(a){var b=k.shift();b&&(a.hasJob=!0,a.onmessage=function(c){var d=b.callback;a.hasJob=!1,e(a),d(c)},a.postMessage(b.message[0],b.message[1]))}function f(a){k.push(a);var b=g();"undefined"!=typeof b&&e(b)}function g(){for(var a=0;a<i.length;a++)if(!i[a].hasJob)return i[a];if(i.length<j){var b=d();return i.push(b),b}return void 0}function h(a){return arguments.length?void(j=a):j}var i=[],j=(navigator.hardwareConcurrency||2)-1,k=[];b.exports.addJob=f,b.exports.maxWorkers=h},{}],43:[function(a,b,c){b.exports=function(){function b(b){h=b.append("div").text("This slide does not contain any spectra. Click to add one.").style({width:i+"px","line-height":j+"px"}).classed("spec-slide empty",!0).on("click",a("./pro/open-file")(b))}function c(d){if(k=d,i=c.width(),j=c.height(),!f)return void b(d);var p=f.nd&&2===f.nd,q=d.config()>1?20:0,r={top:10+q,right:40,bottom:40,left:10+q},s=i-r.left-r.right,t=j-r.top-r.bottom,u=d3.scale.linear().range([0,s]),v=d3.scale.linear().range([t,0]),w=d3.svg.axis().scale(u).orient("bottom"),x=d3.svg.axis().scale(v).orient("right").tickFormat(p?null:d3.format("s")),y=d3.svg.axis().scale(u).orient("bottom").innerTickSize(t).tickFormat(""),z=d3.svg.axis().scale(v).orient("right").innerTickSize(s).tickFormat("");o.idx=0,h=d.append("svg").classed("spec-slide",!0).attr({width:i,height:j}),g=e(h).attr("transform","translate("+r.left+","+r.top+")").attr({width:i,height:j});var A=g.append("defs");if(A.append("clipPath").attr("id",m).append("rect").attr("width",s).attr("height",t),p){var B=1;a("bowser").safari&&(B*=2);var C=A.append("filter").attr("id",n);C.append("feColorMatrix").attr("type","matrix").attr("values","1 0 0 0 0  0 0 0 0 0 1 0 0 0 0 0 0 0 1 0");var D=C.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");D.append("feFuncR").attr("type","linear").attr("slope",-B).attr("intercept","0.5"),D.append("feFuncB").attr("type","linear").attr("slope",B).attr("intercept","-0.5"),D=C.append("feComponentTransfer").attr("color-interpolation-filters","sRGB"),D.append("feFuncR").attr("id","rfunc").attr("type","linear").attr("slope","1"),D.append("feFuncB").attr("id","bfunc").attr("type","linear").attr("slope","1"),C.append("feColorMatrix").attr("type","matrix").attr("values","-10 0 0 0 1 -10 0 -10 0 1 0 0 -10 0 1 0 0 0 1 0")}g.append("g").attr("class","x axis").attr("transform","translate(0,"+t+")"),g.append("g").attr("class","y axis").attr("transform","translate("+s+",0)"),g.append("g").classed("x grid",!0),g.append("g").classed("y grid",!0),g.append("text").attr("class","x axis-label").attr("text-anchor","middle").attr("x",s/2).attr("y",t).attr("dy","2.8em").text("Chemical shift (ppm)"),g.append("text").attr("class","y axis-label").attr("text-anchor","end").attr("y",s).attr("dy","-.75em").attr("transform","rotate(-90)").text("Intensity"),o.on("redraw.slide",function(a){a.x&&(g.select(".x.axis").call(w),d.options.grid.x&&g.select(".x.grid").call(y)),a.y&&(g.select(".y.axis").call(x),d.options.grid.y&&g.select(".y.grid").call(z))}),l=p?a("./d2/spec-container-2d")():a("./d1/spec-container-1d")(),l.datum(f).xScale(u).yScale(v).width(s).height(t).dispatcher(o)(c),d.config()>1&&(a("./d1/scale-brush")().xScale(u).dispatcher(o)(c),a("./d1/scale-brush")().yScale(v).dispatcher(o)(c)),d3.rebind(c,l,"spectra","addSpec","changeRegion","range")}var d=a("./elem"),e=d.Elem("g");d.inherit(c,e);var f,g,h,i,j,k,l,m=a("./utils/guid")(),n=a("./utils/guid")(),o=d3.dispatch("rangechange","regionchange","regionfull","redraw","specDataChange","mouseenter","mouseleave","mousemove","click","keyboard","peakpickEnable","peakdelEnable","peakpick","peakdel","integrateEnable","integrate","integ_refactor","crosshairEnable","blindregion","log");return c.show=function(a){h&&h.classed("active",a)},c.nd=function(){return f?f.nd&&2===f.nd?2:1:0},c.clipId=function(){return m},c.filterId=function(){return n},c.slideDispatcher=function(){return o},c.specContainer=function(){return l},c.datum=function(a){return arguments.length?(f=a,c):f},c.parent=function(){return k},c.spectra=function(){return[]},c.addSpec=function(a){h.remove(),c.datum(a)(k),k.currentSlide()===c&&(c.show(!0),k.dispatcher().menuUpdate())},c}},{"./d1/scale-brush":16,"./d1/spec-container-1d":17,"./d2/spec-container-2d":20,"./elem":22,"./pro/open-file":38,"./utils/guid":49,bowser:3}],44:[function(a,b,c){Array.prototype.subset=function(a){for(var b=[],c=a.length-1;c>=0;c--)b.push(this[a[c]]);return b},Array.prototype.rotate=function(a){return a?this.push(this.shift()):this.unshift(this.pop()),this},Array.prototype.rotateTo=function(a){for(;this[0]!==a;)this.rotate();return this},Array.prototype.whichMax=function(){if(!this.length||0===this.length)return null;if(1===this.length)return 0;for(var a=this[0].y,b=0,c=1;c<this.length;c++)this[c].y>a&&(b=c,a=this[c].y);return b},Array.prototype.cumsum=function(){for(var a=[this[0]],b=0,c=this.length-1;c>b;b++)a[b+1]=a[b]+this[b+1];return a},d3.selection.prototype.selectP=function(a){for(var b=this.node().parentNode;b;){if(b.matches(a))return d3.select(b);b=b.parentNode}return null},d3.selection.prototype.toggleClass=function(a){return this.classed(a,!this.classed(a))},d3.selection.prototype.size=function(){var a=0;return this.each(function(){++a}),a},a("../../lib/d3-tip.edited.js")(d3)},{"../../lib/d3-tip.edited.js":2}],45:[function(a,b,c){"use strict";function d(){if(!g){g=!0;for(var a=0;a<f.length;a++)f[a].fn.call(window,f[a].ctx);f=[]}}function e(){"complete"===document.readyState&&d()}var f=[],g=!1,h=!1;b.exports=function(a,b){return g?void setTimeout(function(){a(b)},1):(f.push({fn:a,ctx:b}),void("complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(d,1):h||(document.addEventListener?(document.addEventListener("DOMContentLoaded",d,!1),window.addEventListener("load",d,!1)):(document.attachEvent("onreadystatechange",e),window.attachEvent("onload",d)),h=!0)))}},{}],46:[function(a,b,c){b.exports=function(a,b){var c;return document.createEventObject?(c=document.createEventObject(),a.fireEvent("on"+b,c)):(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),!a.dispatchEvent(c))}},{}],47:[function(a,b,c){function d(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function e(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function f(a){e()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():d(a)}b.exports.launch=d,b.exports.toggle=f,b.exports.isFull=e},{}],48:[function(a,b,c){b.exports=function(a){var b,c,d=a.clientWidth,e=a.clientHeight;"function"==typeof a.getBoundingClientRect&&(b=a.getBoundingClientRect().width,c=a.getBoundingClientRect().height);var f,g;"function"==typeof getComputedStyle&&(f=getComputedStyle(a).width,g=getComputedStyle(a).height);var h=d3.max([d,b,f]),i=d3.max([e,c,g]);return[h,i]}},{}],49:[function(a,b,c){b.exports=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}},{}],50:[function(a,b,c){b.exports=function(b,c,d){var e=Math.abs(c.domain()[0]-c.domain()[1]),f=Math.abs(c.range()[0]-c.range()[1]),g=e/f;d*=g;var h=a("simplify")(b,d);return h}},{simplify:8}]},{},[24])(24)});